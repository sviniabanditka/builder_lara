!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):e("object"==typeof exports?require("jquery"):jQuery)}(function(e,t){"use strict";if(!e.jstree){var i,r,n=0,s=!1,a=!1,o=!1,d=[],c=e("script:last").attr("src"),h=document,l=h.createElement("LI");l.setAttribute("role","treeitem"),i=h.createElement("I"),i.className="jstree-icon jstree-ocl",i.setAttribute("role","presentation"),l.appendChild(i),i=h.createElement("A"),i.className="jstree-anchor",i.setAttribute("href","#"),i.setAttribute("tabindex","-1"),r=h.createElement("I"),r.className="jstree-icon jstree-themeicon",r.setAttribute("role","presentation"),i.appendChild(r),l.appendChild(i),i=r=null,e.jstree={version:"3.0.9",defaults:{plugins:[]},plugins:{},path:c&&-1!==c.indexOf("/")?c.replace(/\/[^\/]+$/,""):"",idregex:/[\\:&!^|()\[\]<>@*'+~#";.,=\- \/${}%?`]/g},e.jstree.create=function(t,i){var r=new e.jstree.core(++n),s=i;return i=e.extend(!0,{},e.jstree.defaults,i),s&&s.plugins&&(i.plugins=s.plugins),e.each(i.plugins,function(e,t){"core"!==e&&(r=r.plugin(t,i[t]))}),r.init(t,i),r},e.jstree.destroy=function(){e(".jstree:jstree").jstree("destroy"),e(document).off(".jstree")},e.jstree.core=function(e){this._id=e,this._cnt=0,this._wrk=null,this._data={core:{themes:{name:!1,dots:!1,icons:!1},selected:[],last_error:{},working:!1,worker_queue:[],focused:null}}},e.jstree.reference=function(t){var i=null,r=null;if(t&&t.id&&(t=t.id),!r||!r.length)try{r=e(t)}catch(e){}if(!r||!r.length)try{r=e("#"+t.replace(e.jstree.idregex,"\\$&"))}catch(e){}return r&&r.length&&(r=r.closest(".jstree")).length&&(r=r.data("jstree"))?i=r:e(".jstree").each(function(){var r=e(this).data("jstree");return r&&r._model.data[t]?(i=r,!1):void 0}),i},e.fn.jstree=function(i){var r="string"==typeof i,n=Array.prototype.slice.call(arguments,1),s=null;return!(!0===i&&!this.length)&&(this.each(function(){var a=e.jstree.reference(this),o=r&&a?a[i]:null;return s=r&&o?o.apply(a,n):null,a||r||i!==t&&!e.isPlainObject(i)||e(this).data("jstree",new e.jstree.create(this,i)),(a&&!r||!0===i)&&(s=a||!1),(null===s||s===t)&&void 0}),null!==s&&s!==t?s:this)},e.expr[":"].jstree=e.expr.createPseudo(function(i){return function(i){return e(i).hasClass("jstree")&&e(i).data("jstree")!==t}}),e.jstree.defaults.core={data:!1,strings:!1,check_callback:!1,error:e.noop,animation:200,multiple:!0,themes:{name:!1,url:!1,dir:!1,dots:!0,icons:!0,stripes:!1,variant:!1,responsive:!1},expand_selected_onload:!0,worker:!0,force_text:!1,dblclick_toggle:!0},e.jstree.core.prototype={plugin:function(t,i){var r=e.jstree.plugins[t];return r?(this._data[t]={},r.prototype=this,new r(i,this)):this},init:function(t,i){this._model={data:{"#":{id:"#",parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}}},changed:[],force_full_redraw:!1,redraw_timeout:!1,default_state:{loaded:!0,opened:!1,selected:!1,disabled:!1}},this.element=e(t).addClass("jstree jstree-"+this._id),this.settings=i,this._data.core.ready=!1,this._data.core.loaded=!1,this._data.core.rtl="rtl"===this.element.css("direction"),this.element[this._data.core.rtl?"addClass":"removeClass"]("jstree-rtl"),this.element.attr("role","tree"),this.settings.core.multiple&&this.element.attr("aria-multiselectable",!0),this.element.attr("tabindex")||this.element.attr("tabindex","0"),this.bind(),this.trigger("init"),this._data.core.original_container_html=this.element.find(" > ul > li").clone(!0),this._data.core.original_container_html.find("li").addBack().contents().filter(function(){return 3===this.nodeType&&(!this.nodeValue||/^\s+$/.test(this.nodeValue))}).remove(),this.element.html("<ul class='jstree-container-ul jstree-children' role='group'><li id='j"+this._id+"_loading' class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='tree-item'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>"),this.element.attr("aria-activedescendant","j"+this._id+"_loading"),this._data.core.li_height=this.get_container_ul().children("li").first().height()||24,this.trigger("loading"),this.load_node("#")},destroy:function(e){if(this._wrk)try{window.URL.revokeObjectURL(this._wrk),this._wrk=null}catch(e){}e||this.element.empty(),this.teardown()},teardown:function(){this.unbind(),this.element.removeClass("jstree").removeData("jstree").find("[class^='jstree']").addBack().attr("class",function(){return this.className.replace(/jstree[^ ]*|$/gi,"")}),this.element=null},bind:function(){var t="",i=null,r=0;this.element.on("dblclick.jstree",function(){if(document.selection&&document.selection.empty)document.selection.empty();else if(window.getSelection){var e=window.getSelection();try{e.removeAllRanges(),e.collapse()}catch(e){}}}).on("mousedown.jstree",e.proxy(function(e){e.target===this.element[0]&&(e.preventDefault(),r=+new Date)},this)).on("mousedown.jstree",".jstree-ocl",function(e){e.preventDefault()}).on("click.jstree",".jstree-ocl",e.proxy(function(e){this.toggle_node(e.target)},this)).on("dblclick.jstree",".jstree-anchor",e.proxy(function(e){this.settings.core.dblclick_toggle&&this.toggle_node(e.target)},this)).on("click.jstree",".jstree-anchor",e.proxy(function(t){t.preventDefault(),t.currentTarget!==document.activeElement&&e(t.currentTarget).focus(),this.activate_node(t.currentTarget,t)},this)).on("keydown.jstree",".jstree-anchor",e.proxy(function(t){if("INPUT"===t.target.tagName)return!0;var i=null;switch(this._data.core.rtl&&(37===t.which?t.which=39:39===t.which&&(t.which=37)),t.which){case 32:t.ctrlKey&&(t.type="click",e(t.currentTarget).trigger(t));break;case 13:t.type="click",e(t.currentTarget).trigger(t);break;case 37:t.preventDefault(),this.is_open(t.currentTarget)?this.close_node(t.currentTarget):(i=this.get_parent(t.currentTarget))&&"#"!==i.id&&this.get_node(i,!0).children(".jstree-anchor").focus();break;case 38:t.preventDefault(),(i=this.get_prev_dom(t.currentTarget))&&i.length&&i.children(".jstree-anchor").focus();break;case 39:t.preventDefault(),this.is_closed(t.currentTarget)?this.open_node(t.currentTarget,function(e){this.get_node(e,!0).children(".jstree-anchor").focus()}):this.is_open(t.currentTarget)&&(i=this.get_node(t.currentTarget,!0).children(".jstree-children")[0])&&e(this._firstChild(i)).children(".jstree-anchor").focus();break;case 40:t.preventDefault(),(i=this.get_next_dom(t.currentTarget))&&i.length&&i.children(".jstree-anchor").focus();break;case 106:this.open_all();break;case 36:t.preventDefault(),(i=this._firstChild(this.get_container_ul()[0]))&&e(i).children(".jstree-anchor").filter(":visible").focus();break;case 35:t.preventDefault(),this.element.find(".jstree-anchor").filter(":visible").last().focus()}},this)).on("load_node.jstree",e.proxy(function(t,i){i.status&&("#"!==i.node.id||this._data.core.loaded||(this._data.core.loaded=!0,this._firstChild(this.get_container_ul()[0])&&this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id),this.trigger("loaded")),this._data.core.ready||setTimeout(e.proxy(function(){if(!this.get_container_ul().find(".jstree-loading").length){if(this._data.core.ready=!0,this._data.core.selected.length){if(this.settings.core.expand_selected_onload){var t,i,r=[];for(t=0,i=this._data.core.selected.length;i>t;t++)r=r.concat(this._model.data[this._data.core.selected[t]].parents);for(r=e.vakata.array_unique(r),t=0,i=r.length;i>t;t++)this.open_node(r[t],!1,0)}this.trigger("changed",{action:"ready",selected:this._data.core.selected})}this.trigger("ready")}},this),0))},this)).on("keypress.jstree",e.proxy(function(r){if("INPUT"===r.target.tagName)return!0;i&&clearTimeout(i),i=setTimeout(function(){t=""},500);var n=String.fromCharCode(r.which).toLowerCase(),s=this.element.find(".jstree-anchor").filter(":visible"),a=s.index(document.activeElement)||0,o=!1;if(t+=n,t.length>1){if(s.slice(a).each(e.proxy(function(i,r){return 0===e(r).text().toLowerCase().indexOf(t)?(e(r).focus(),o=!0,!1):void 0},this)),o)return;if(s.slice(0,a).each(e.proxy(function(i,r){return 0===e(r).text().toLowerCase().indexOf(t)?(e(r).focus(),o=!0,!1):void 0},this)),o)return}if(new RegExp("^"+n+"+$").test(t)){if(s.slice(a+1).each(e.proxy(function(t,i){return e(i).text().toLowerCase().charAt(0)===n?(e(i).focus(),o=!0,!1):void 0},this)),o)return;if(s.slice(0,a+1).each(e.proxy(function(t,i){return e(i).text().toLowerCase().charAt(0)===n?(e(i).focus(),o=!0,!1):void 0},this)),o)return}},this)).on("init.jstree",e.proxy(function(){var e=this.settings.core.themes;this._data.core.themes.dots=e.dots,this._data.core.themes.stripes=e.stripes,this._data.core.themes.icons=e.icons,this.set_theme(e.name||"default",e.url),this.set_theme_variant(e.variant)},this)).on("loading.jstree",e.proxy(function(){this[this._data.core.themes.dots?"show_dots":"hide_dots"](),this[this._data.core.themes.icons?"show_icons":"hide_icons"](),this[this._data.core.themes.stripes?"show_stripes":"hide_stripes"]()},this)).on("blur.jstree",".jstree-anchor",e.proxy(function(t){this._data.core.focused=null,e(t.currentTarget).filter(".jstree-hovered").mouseleave(),this.element.attr("tabindex","0")},this)).on("focus.jstree",".jstree-anchor",e.proxy(function(t){var i=this.get_node(t.currentTarget);i&&i.id&&(this._data.core.focused=i.id),this.element.find(".jstree-hovered").not(t.currentTarget).mouseleave(),e(t.currentTarget).mouseenter(),this.element.attr("tabindex","-1")},this)).on("focus.jstree",e.proxy(function(){+new Date-r>500&&!this._data.core.focused&&(r=0,this.get_node(this.element.attr("aria-activedescendant"),!0).find("> .jstree-anchor").focus())},this)).on("mouseenter.jstree",".jstree-anchor",e.proxy(function(e){this.hover_node(e.currentTarget)},this)).on("mouseleave.jstree",".jstree-anchor",e.proxy(function(e){this.dehover_node(e.currentTarget)},this))},unbind:function(){this.element.off(".jstree"),e(document).off(".jstree-"+this._id)},trigger:function(e,t){t||(t={}),t.instance=this,this.element.triggerHandler(e.replace(".jstree","")+".jstree",t)},get_container:function(){return this.element},get_container_ul:function(){return this.element.children(".jstree-children").first()},get_string:function(t){var i=this.settings.core.strings;return e.isFunction(i)?i.call(this,t):i&&i[t]?i[t]:t},_firstChild:function(e){for(e=e?e.firstChild:null;null!==e&&1!==e.nodeType;)e=e.nextSibling;return e},_nextSibling:function(e){for(e=e?e.nextSibling:null;null!==e&&1!==e.nodeType;)e=e.nextSibling;return e},_previousSibling:function(e){for(e=e?e.previousSibling:null;null!==e&&1!==e.nodeType;)e=e.previousSibling;return e},get_node:function(t,i){t&&t.id&&(t=t.id);var r;try{if(this._model.data[t])t=this._model.data[t];else if("string"==typeof t&&this._model.data[t.replace(/^#/,"")])t=this._model.data[t.replace(/^#/,"")];else if("string"==typeof t&&(r=e("#"+t.replace(e.jstree.idregex,"\\$&"),this.element)).length&&this._model.data[r.closest(".jstree-node").attr("id")])t=this._model.data[r.closest(".jstree-node").attr("id")];else if((r=e(t,this.element)).length&&this._model.data[r.closest(".jstree-node").attr("id")])t=this._model.data[r.closest(".jstree-node").attr("id")];else{if(!(r=e(t,this.element)).length||!r.hasClass("jstree"))return!1;t=this._model.data["#"]}return i&&(t="#"===t.id?this.element:e("#"+t.id.replace(e.jstree.idregex,"\\$&"),this.element)),t}catch(e){return!1}},get_path:function(e,t,i){if(!(e=e.parents?e:this.get_node(e))||"#"===e.id||!e.parents)return!1;var r,n,s=[];for(s.push(i?e.id:e.text),r=0,n=e.parents.length;n>r;r++)s.push(i?e.parents[r]:this.get_text(e.parents[r]));return s=s.reverse().slice(1),t?s.join(t):s},get_next_dom:function(t,i){var r;if(t=this.get_node(t,!0),t[0]===this.element[0]){for(r=this._firstChild(this.get_container_ul()[0]);r&&0===r.offsetHeight;)r=this._nextSibling(r);return!!r&&e(r)}if(!t||!t.length)return!1;if(i){r=t[0];do{r=this._nextSibling(r)}while(r&&0===r.offsetHeight);return!!r&&e(r)}if(t.hasClass("jstree-open")){for(r=this._firstChild(t.children(".jstree-children")[0]);r&&0===r.offsetHeight;)r=this._nextSibling(r);if(null!==r)return e(r)}r=t[0];do{r=this._nextSibling(r)}while(r&&0===r.offsetHeight);return null!==r?e(r):t.parentsUntil(".jstree",".jstree-node").next(".jstree-node:visible").first()},get_prev_dom:function(t,i){var r;if(t=this.get_node(t,!0),t[0]===this.element[0]){for(r=this.get_container_ul()[0].lastChild;r&&0===r.offsetHeight;)r=this._previousSibling(r);return!!r&&e(r)}if(!t||!t.length)return!1;if(i){r=t[0];do{r=this._previousSibling(r)}while(r&&0===r.offsetHeight);return!!r&&e(r)}r=t[0];do{r=this._previousSibling(r)}while(r&&0===r.offsetHeight);if(null!==r){for(t=e(r);t.hasClass("jstree-open");)t=t.children(".jstree-children").first().children(".jstree-node:visible:last");return t}return!(!(r=t[0].parentNode.parentNode)||!r.className||-1===r.className.indexOf("jstree-node"))&&e(r)},get_parent:function(e){return!(!(e=this.get_node(e))||"#"===e.id)&&e.parent},get_children_dom:function(e){return e=this.get_node(e,!0),e[0]===this.element[0]?this.get_container_ul().children(".jstree-node"):!(!e||!e.length)&&e.children(".jstree-children").children(".jstree-node")},is_parent:function(e){return(e=this.get_node(e))&&(!1===e.state.loaded||e.children.length>0)},is_loaded:function(e){return(e=this.get_node(e))&&e.state.loaded},is_loading:function(e){return(e=this.get_node(e))&&e.state&&e.state.loading},is_open:function(e){return(e=this.get_node(e))&&e.state.opened},is_closed:function(e){return(e=this.get_node(e))&&this.is_parent(e)&&!e.state.opened},is_leaf:function(e){return!this.is_parent(e)},load_node:function(t,i){var r,n,s,a,o;if(e.isArray(t))return this._load_nodes(t.slice(),i),!0;if(!(t=this.get_node(t)))return i&&i.call(this,t,!1),!1;if(t.state.loaded){for(t.state.loaded=!1,r=0,n=t.children_d.length;n>r;r++){for(s=0,a=t.parents.length;a>s;s++)this._model.data[t.parents[s]].children_d=e.vakata.array_remove_item(this._model.data[t.parents[s]].children_d,t.children_d[r]);this._model.data[t.children_d[r]].state.selected&&(o=!0,this._data.core.selected=e.vakata.array_remove_item(this._data.core.selected,t.children_d[r])),delete this._model.data[t.children_d[r]]}t.children=[],t.children_d=[],o&&this.trigger("changed",{action:"load_node",node:t,selected:this._data.core.selected})}return t.state.loading=!0,this.get_node(t,!0).addClass("jstree-loading").attr("aria-busy",!0),this._load_node(t,e.proxy(function(e){t=this._model.data[t.id],t.state.loading=!1,t.state.loaded=e;var r=this.get_node(t,!0);t.state.loaded&&!t.children.length&&r&&r.length&&!r.hasClass("jstree-leaf")&&r.removeClass("jstree-closed jstree-open").addClass("jstree-leaf"),r.removeClass("jstree-loading").attr("aria-busy",!1),this.trigger("load_node",{node:t,status:e}),i&&i.call(this,t,e)},this)),!0},_load_nodes:function(e,t,i){var r,n,s=!0,a=function(){this._load_nodes(e,t,!0)},o=this._model.data;for(r=0,n=e.length;n>r;r++)!o[e[r]]||o[e[r]].state.loaded&&i||(this.is_loading(e[r])||this.load_node(e[r],a),s=!1);s&&t&&!t.done&&(t.call(this,e),t.done=!0)},load_all:function(e,t){if(e||(e="#"),!(e=this.get_node(e)))return!1;var i,r,n=[],s=this._model.data,a=s[e.id].children_d;for(e.state&&!e.state.loaded&&n.push(e.id),i=0,r=a.length;r>i;i++)s[a[i]]&&s[a[i]].state&&!s[a[i]].state.loaded&&n.push(a[i]);n.length?this._load_nodes(n,function(){this.load_all(e,t)}):(t&&t.call(this,e),this.trigger("load_all",{node:e}))},_load_node:function(t,i){var r,n=this.settings.core.data;return n?e.isFunction(n)?n.call(this,t,e.proxy(function(r){!1===r&&i.call(this,!1),this["string"==typeof r?"_append_html_data":"_append_json_data"](t,"string"==typeof r?e(r):r,function(e){i.call(this,e)})},this)):"object"==typeof n?n.url?(n=e.extend(!0,{},n),e.isFunction(n.url)&&(n.url=n.url.call(this,t)),e.isFunction(n.data)&&(n.data=n.data.call(this,t)),e.ajax(n).done(e.proxy(function(r,n,s){var a=s.getResponseHeader("Content-Type");return-1!==a.indexOf("json")||"object"==typeof r?this._append_json_data(t,r,function(e){i.call(this,e)}):-1!==a.indexOf("html")||"string"==typeof r?this._append_html_data(t,e(r),function(e){i.call(this,e)}):(this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:t.id,xhr:s})},this.settings.core.error.call(this,this._data.core.last_error),i.call(this,!1))},this)).fail(e.proxy(function(e){i.call(this,!1),this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:t.id,xhr:e})},this.settings.core.error.call(this,this._data.core.last_error)},this))):(r=e.isArray(n)||e.isPlainObject(n)?JSON.parse(JSON.stringify(n)):n,"#"===t.id?this._append_json_data(t,r,function(e){i.call(this,e)}):(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_05",reason:"Could not load node",data:JSON.stringify({id:t.id})},this.settings.core.error.call(this,this._data.core.last_error),i.call(this,!1))):"string"==typeof n?"#"===t.id?this._append_html_data(t,e(n),function(e){i.call(this,e)}):(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_06",reason:"Could not load node",data:JSON.stringify({id:t.id})},this.settings.core.error.call(this,this._data.core.last_error),i.call(this,!1)):i.call(this,!1):"#"===t.id?this._append_html_data(t,this._data.core.original_container_html.clone(!0),function(e){i.call(this,e)}):i.call(this,!1)},_node_changed:function(e){(e=this.get_node(e))&&this._model.changed.push(e.id)},_append_html_data:function(t,i,r){t=this.get_node(t),t.children=[],t.children_d=[];var n,s,a,o=i.is("ul")?i.children():i,d=t.id,c=[],h=[],l=this._model.data,u=l[d],_=this._data.core.selected.length;for(o.each(e.proxy(function(t,i){(n=this._parse_model_from_html(e(i),d,u.parents.concat()))&&(c.push(n),h.push(n),l[n].children_d.length&&(h=h.concat(l[n].children_d)))},this)),u.children=c,u.children_d=h,s=0,a=u.parents.length;a>s;s++)l[u.parents[s]].children_d=l[u.parents[s]].children_d.concat(h);this.trigger("model",{nodes:h,parent:d}),"#"!==d?(this._node_changed(d),this.redraw()):(this.get_container_ul().children(".jstree-initial-node").remove(),this.redraw(!0)),this._data.core.selected.length!==_&&this.trigger("changed",{action:"model",selected:this._data.core.selected}),r.call(this,!0)},_append_json_data:function(t,i,r,n){t=this.get_node(t),t.children=[],t.children_d=[],i.d&&"string"==typeof(i=i.d)&&(i=JSON.parse(i)),e.isArray(i)||(i=[i]);var s=null,a={df:this._model.default_state,dat:i,par:t.id,m:this._model.data,t_id:this._id,t_cnt:this._cnt,sel:this._data.core.selected},o=function(e,t){e.data&&(e=e.data);var i,r,n,s,a=e.dat,o=e.par,d=[],c=[],h=[],l=e.df,u=e.t_id,_=e.t_cnt,p=e.m,f=p[o],g=e.sel,m=function(e,i,r){r=r?r.concat():[],i&&r.unshift(i);var n,s,a,o,d=e.id.toString(),c={id:d,text:e.text||"",icon:e.icon===t||e.icon,parent:i,parents:r,children:e.children||[],children_d:e.children_d||[],data:e.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(n in l)l.hasOwnProperty(n)&&(c.state[n]=l[n]);if(e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(c.icon=e.data.jstree.icon),e&&e.data&&(c.data=e.data,e.data.jstree))for(n in e.data.jstree)e.data.jstree.hasOwnProperty(n)&&(c.state[n]=e.data.jstree[n]);if(e&&"object"==typeof e.state)for(n in e.state)e.state.hasOwnProperty(n)&&(c.state[n]=e.state[n]);if(e&&"object"==typeof e.li_attr)for(n in e.li_attr)e.li_attr.hasOwnProperty(n)&&(c.li_attr[n]=e.li_attr[n]);if(c.li_attr.id||(c.li_attr.id=d),e&&"object"==typeof e.a_attr)for(n in e.a_attr)e.a_attr.hasOwnProperty(n)&&(c.a_attr[n]=e.a_attr[n]);for(e&&e.children&&!0===e.children&&(c.state.loaded=!1,c.children=[],c.children_d=[]),p[c.id]=c,n=0,s=c.children.length;s>n;n++)a=m(p[c.children[n]],c.id,r),o=p[a],c.children_d.push(a),o.children_d.length&&(c.children_d=c.children_d.concat(o.children_d));return delete e.data,delete e.children,p[c.id].original=e,c.state.selected&&h.push(c.id),c.id},v=function(e,i,r){r=r?r.concat():[],i&&r.unshift(i);var n,s,a,o,d,c=!1;do{c="j"+u+"_"+ ++_}while(p[c]);d={id:!1,text:"string"==typeof e?e:"",icon:"object"!=typeof e||e.icon===t||e.icon,parent:i,parents:r,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(n in l)l.hasOwnProperty(n)&&(d.state[n]=l[n]);if(e&&e.id&&(d.id=e.id.toString()),e&&e.text&&(d.text=e.text),e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(d.icon=e.data.jstree.icon),e&&e.data&&(d.data=e.data,e.data.jstree))for(n in e.data.jstree)e.data.jstree.hasOwnProperty(n)&&(d.state[n]=e.data.jstree[n]);if(e&&"object"==typeof e.state)for(n in e.state)e.state.hasOwnProperty(n)&&(d.state[n]=e.state[n]);if(e&&"object"==typeof e.li_attr)for(n in e.li_attr)e.li_attr.hasOwnProperty(n)&&(d.li_attr[n]=e.li_attr[n]);if(d.li_attr.id&&!d.id&&(d.id=d.li_attr.id.toString()),d.id||(d.id=c),d.li_attr.id||(d.li_attr.id=d.id),e&&"object"==typeof e.a_attr)for(n in e.a_attr)e.a_attr.hasOwnProperty(n)&&(d.a_attr[n]=e.a_attr[n]);if(e&&e.children&&e.children.length){for(n=0,s=e.children.length;s>n;n++)a=v(e.children[n],d.id,r),o=p[a],d.children.push(a),o.children_d.length&&(d.children_d=d.children_d.concat(o.children_d));d.children_d=d.children_d.concat(d.children)}return e&&e.children&&!0===e.children&&(d.state.loaded=!1,d.children=[],d.children_d=[]),delete e.data,delete e.children,d.original=e,p[d.id]=d,d.state.selected&&h.push(d.id),d.id};if(a.length&&a[0].id!==t&&a[0].parent!==t){for(r=0,n=a.length;n>r;r++)a[r].children||(a[r].children=[]),p[a[r].id.toString()]=a[r];for(r=0,n=a.length;n>r;r++)p[a[r].parent.toString()].children.push(a[r].id.toString()),f.children_d.push(a[r].id.toString());for(r=0,n=f.children.length;n>r;r++)i=m(p[f.children[r]],o,f.parents.concat()),c.push(i),p[i].children_d.length&&(c=c.concat(p[i].children_d));for(r=0,n=f.parents.length;n>r;r++)p[f.parents[r]].children_d=p[f.parents[r]].children_d.concat(c);s={cnt:_,mod:p,sel:g,par:o,dpc:c,add:h}}else{for(r=0,n=a.length;n>r;r++)(i=v(a[r],o,f.parents.concat()))&&(d.push(i),c.push(i),p[i].children_d.length&&(c=c.concat(p[i].children_d)));for(f.children=d,f.children_d=c,r=0,n=f.parents.length;n>r;r++)p[f.parents[r]].children_d=p[f.parents[r]].children_d.concat(c);s={cnt:_,mod:p,sel:g,par:o,dpc:c,add:h}}return"undefined"!=typeof window&&void 0!==window.document?s:void postMessage(s)},d=function(t,i){if(this._cnt=t.cnt,this._model.data=t.mod,i){var n,s,a=t.add,o=t.sel,d=this._data.core.selected.slice(),c=this._model.data;if(o.length!==d.length||e.vakata.array_unique(o.concat(d)).length!==o.length){for(n=0,s=o.length;s>n;n++)-1===e.inArray(o[n],a)&&-1===e.inArray(o[n],d)&&(c[o[n]].state.selected=!1);for(n=0,s=d.length;s>n;n++)-1===e.inArray(d[n],o)&&(c[d[n]].state.selected=!0)}}t.add.length&&(this._data.core.selected=this._data.core.selected.concat(t.add)),this.trigger("model",{nodes:t.dpc,parent:t.par}),"#"!==t.par?(this._node_changed(t.par),this.redraw()):this.redraw(!0),t.add.length&&this.trigger("changed",{action:"model",selected:this._data.core.selected}),r.call(this,!0)};if(this.settings.core.worker&&window.Blob&&window.URL&&window.Worker)try{null===this._wrk&&(this._wrk=window.URL.createObjectURL(new window.Blob(["self.onmessage = "+o.toString()],{type:"text/javascript"}))),!this._data.core.working||n?(this._data.core.working=!0,s=new window.Worker(this._wrk),s.onmessage=e.proxy(function(e){d.call(this,e.data,!0);try{s.terminate(),s=null}catch(e){}this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1},this),a.par?s.postMessage(a):this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1):this._data.core.worker_queue.push([t,i,r,!0])}catch(e){d.call(this,o(a),!1),this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1}else d.call(this,o(a),!1)},_parse_model_from_html:function(t,i,r){r=r?[].concat(r):[],i&&r.unshift(i);var n,s,a,o,d,c=this._model.data,h={id:!1,text:!1,icon:!0,parent:i,parents:r,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(a in this._model.default_state)this._model.default_state.hasOwnProperty(a)&&(h.state[a]=this._model.default_state[a]);if(o=e.vakata.attributes(t,!0),e.each(o,function(t,i){return i=e.trim(i),!i.length||(h.li_attr[t]=i,void("id"===t&&(h.id=i.toString())))}),o=t.children("a").first(),o.length&&(o=e.vakata.attributes(o,!0),e.each(o,function(t,i){i=e.trim(i),i.length&&(h.a_attr[t]=i)})),o=t.children("a").first().length?t.children("a").first().clone():t.clone(),o.children("ins, i, ul").remove(),o=o.html(),o=e("<div />").html(o),h.text=this.settings.core.force_text?o.text():o.html(),o=t.data(),h.data=o?e.extend(!0,{},o):null,h.state.opened=t.hasClass("jstree-open"),h.state.selected=t.children("a").hasClass("jstree-clicked"),h.state.disabled=t.children("a").hasClass("jstree-disabled"),h.data&&h.data.jstree)for(a in h.data.jstree)h.data.jstree.hasOwnProperty(a)&&(h.state[a]=h.data.jstree[a]);o=t.children("a").children(".jstree-themeicon"),o.length&&(h.icon=!o.hasClass("jstree-themeicon-hidden")&&o.attr("rel")),h.state.icon&&(h.icon=h.state.icon),o=t.children("ul").children("li");do{d="j"+this._id+"_"+ ++this._cnt}while(c[d]);return h.id=h.li_attr.id?h.li_attr.id.toString():d,o.length?(o.each(e.proxy(function(t,i){n=this._parse_model_from_html(e(i),h.id,r),s=this._model.data[n],h.children.push(n),s.children_d.length&&(h.children_d=h.children_d.concat(s.children_d))},this)),h.children_d=h.children_d.concat(h.children)):t.hasClass("jstree-closed")&&(h.state.loaded=!1),h.li_attr.class&&(h.li_attr.class=h.li_attr.class.replace("jstree-closed","").replace("jstree-open","")),h.a_attr.class&&(h.a_attr.class=h.a_attr.class.replace("jstree-clicked","").replace("jstree-disabled","")),c[h.id]=h,h.state.selected&&this._data.core.selected.push(h.id),h.id},_parse_model_from_flat_json:function(e,i,r){r=r?r.concat():[],i&&r.unshift(i);var n,s,a,o,d=e.id.toString(),c=this._model.data,h=this._model.default_state,l={id:d,text:e.text||"",icon:e.icon===t||e.icon,parent:i,parents:r,children:e.children||[],children_d:e.children_d||[],data:e.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(n in h)h.hasOwnProperty(n)&&(l.state[n]=h[n]);if(e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(l.icon=e.data.jstree.icon),e&&e.data&&(l.data=e.data,e.data.jstree))for(n in e.data.jstree)e.data.jstree.hasOwnProperty(n)&&(l.state[n]=e.data.jstree[n]);if(e&&"object"==typeof e.state)for(n in e.state)e.state.hasOwnProperty(n)&&(l.state[n]=e.state[n]);if(e&&"object"==typeof e.li_attr)for(n in e.li_attr)e.li_attr.hasOwnProperty(n)&&(l.li_attr[n]=e.li_attr[n]);if(l.li_attr.id||(l.li_attr.id=d),e&&"object"==typeof e.a_attr)for(n in e.a_attr)e.a_attr.hasOwnProperty(n)&&(l.a_attr[n]=e.a_attr[n]);for(e&&e.children&&!0===e.children&&(l.state.loaded=!1,l.children=[],l.children_d=[]),c[l.id]=l,n=0,s=l.children.length;s>n;n++)a=this._parse_model_from_flat_json(c[l.children[n]],l.id,r),o=c[a],l.children_d.push(a),o.children_d.length&&(l.children_d=l.children_d.concat(o.children_d));return delete e.data,delete e.children,c[l.id].original=e,l.state.selected&&this._data.core.selected.push(l.id),l.id},_parse_model_from_json:function(e,i,r){r=r?r.concat():[],i&&r.unshift(i);var n,s,a,o,d,c=!1,h=this._model.data,l=this._model.default_state;do{c="j"+this._id+"_"+ ++this._cnt}while(h[c]);d={id:!1,text:"string"==typeof e?e:"",icon:"object"!=typeof e||e.icon===t||e.icon,parent:i,parents:r,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(n in l)l.hasOwnProperty(n)&&(d.state[n]=l[n]);if(e&&e.id&&(d.id=e.id.toString()),e&&e.text&&(d.text=e.text),e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(d.icon=e.data.jstree.icon),e&&e.data&&(d.data=e.data,e.data.jstree))for(n in e.data.jstree)e.data.jstree.hasOwnProperty(n)&&(d.state[n]=e.data.jstree[n]);if(e&&"object"==typeof e.state)for(n in e.state)e.state.hasOwnProperty(n)&&(d.state[n]=e.state[n]);if(e&&"object"==typeof e.li_attr)for(n in e.li_attr)e.li_attr.hasOwnProperty(n)&&(d.li_attr[n]=e.li_attr[n]);if(d.li_attr.id&&!d.id&&(d.id=d.li_attr.id.toString()),d.id||(d.id=c),d.li_attr.id||(d.li_attr.id=d.id),e&&"object"==typeof e.a_attr)for(n in e.a_attr)e.a_attr.hasOwnProperty(n)&&(d.a_attr[n]=e.a_attr[n]);if(e&&e.children&&e.children.length){for(n=0,s=e.children.length;s>n;n++)a=this._parse_model_from_json(e.children[n],d.id,r),o=h[a],d.children.push(a),o.children_d.length&&(d.children_d=d.children_d.concat(o.children_d));d.children_d=d.children_d.concat(d.children)}return e&&e.children&&!0===e.children&&(d.state.loaded=!1,d.children=[],d.children_d=[]),delete e.data,delete e.children,d.original=e,h[d.id]=d,d.state.selected&&this._data.core.selected.push(d.id),d.id},_redraw:function(){var e,t,i,r=this._model.force_full_redraw?this._model.data["#"].children.concat([]):this._model.changed.concat([]),n=document.createElement("UL"),s=this._data.core.focused;for(t=0,i=r.length;i>t;t++)(e=this.redraw_node(r[t],!0,this._model.force_full_redraw))&&this._model.force_full_redraw&&n.appendChild(e);this._model.force_full_redraw&&(n.className=this.get_container_ul()[0].className,n.setAttribute("role","group"),this.element.empty().append(n)),null!==s&&(e=this.get_node(s,!0),e&&e.length&&e.children(".jstree-anchor")[0]!==document.activeElement?e.children(".jstree-anchor").focus():this._data.core.focused=null),this._model.force_full_redraw=!1,this._model.changed=[],this.trigger("redraw",{nodes:r})},redraw:function(e){e&&(this._model.force_full_redraw=!0),this._redraw()},draw_children:function(e){var t=this.get_node(e),i=!1,r=!1,n=!1,s=document;if(!t)return!1;if("#"===t.id)return this.redraw(!0);if(!(e=this.get_node(e,!0))||!e.length)return!1;if(e.children(".jstree-children").remove(),e=e[0],t.children.length&&t.state.loaded){for(n=s.createElement("UL"),n.setAttribute("role","group"),n.className="jstree-children",i=0,r=t.children.length;r>i;i++)n.appendChild(this.redraw_node(t.children[i],!0,!0));e.appendChild(n)}},redraw_node:function(t,i,r,n){var s=this.get_node(t),a=!1,o=!1,d=!1,c=!1,h=!1,u=!1,_="",p=document,f=this._model.data,g=!1,m=null,v=0,y=0;if(!s)return!1;if("#"===s.id)return this.redraw(!0);if(i=i||0===s.children.length,t=document.querySelector?this.element[0].querySelector("#"+(-1!=="0123456789".indexOf(s.id[0])?"\\3"+s.id[0]+" "+s.id.substr(1).replace(e.jstree.idregex,"\\$&"):s.id.replace(e.jstree.idregex,"\\$&"))):document.getElementById(s.id))t=e(t),r||(a=t.parent().parent()[0],a===this.element[0]&&(a=null),o=t.index()),i||!s.children.length||t.children(".jstree-children").length||(i=!0),i||(d=t.children(".jstree-children")[0]),g=t.children(".jstree-anchor")[0]===document.activeElement,t.remove();else if(i=!0,!r){if(!(null===(a="#"!==s.parent?e("#"+s.parent.replace(e.jstree.idregex,"\\$&"),this.element)[0]:null)||a&&f[s.parent].state.opened))return!1;o=e.inArray(s.id,null===a?f["#"].children:f[s.parent].children)}t=l.cloneNode(!0),_="jstree-node ";for(c in s.li_attr)if(s.li_attr.hasOwnProperty(c)){if("id"===c)continue;"class"!==c?t.setAttribute(c,s.li_attr[c]):_+=s.li_attr[c]}s.a_attr.id||(s.a_attr.id=s.id+"_anchor"),t.setAttribute("aria-selected",!!s.state.selected),t.setAttribute("aria-level",s.parents.length),t.setAttribute("aria-labelledby",s.a_attr.id),s.state.disabled&&t.setAttribute("aria-disabled",!0),s.state.loaded&&!s.children.length?_+=" jstree-leaf":(_+=s.state.opened&&s.state.loaded?" jstree-open":" jstree-closed",t.setAttribute("aria-expanded",s.state.opened&&s.state.loaded)),null!==s.parent&&f[s.parent].children[f[s.parent].children.length-1]===s.id&&(_+=" jstree-last"),t.id=s.id,t.className=_,_=(s.state.selected?" jstree-clicked":"")+(s.state.disabled?" jstree-disabled":"");for(h in s.a_attr)if(s.a_attr.hasOwnProperty(h)){if("href"===h&&"#"===s.a_attr[h])continue;"class"!==h?t.childNodes[1].setAttribute(h,s.a_attr[h]):_+=" "+s.a_attr[h]}if(_.length&&(t.childNodes[1].className="jstree-anchor "+_),
(s.icon&&!0!==s.icon||!1===s.icon)&&(!1===s.icon?t.childNodes[1].childNodes[0].className+=" jstree-themeicon-hidden":-1===s.icon.indexOf("/")&&-1===s.icon.indexOf(".")?t.childNodes[1].childNodes[0].className+=" "+s.icon+" jstree-themeicon-custom":(t.childNodes[1].childNodes[0].style.backgroundImage="url("+s.icon+")",t.childNodes[1].childNodes[0].style.backgroundPosition="center center",t.childNodes[1].childNodes[0].style.backgroundSize="auto",t.childNodes[1].childNodes[0].className+=" jstree-themeicon-custom")),this.settings.core.force_text?t.childNodes[1].appendChild(p.createTextNode(s.text)):t.childNodes[1].innerHTML+=s.text,i&&s.children.length&&(s.state.opened||n)&&s.state.loaded){for(u=p.createElement("UL"),u.setAttribute("role","group"),u.className="jstree-children",c=0,h=s.children.length;h>c;c++)u.appendChild(this.redraw_node(s.children[c],i,!0));t.appendChild(u)}if(d&&t.appendChild(d),!r){for(a||(a=this.element[0]),c=0,h=a.childNodes.length;h>c;c++)if(a.childNodes[c]&&a.childNodes[c].className&&-1!==a.childNodes[c].className.indexOf("jstree-children")){m=a.childNodes[c];break}m||(m=p.createElement("UL"),m.setAttribute("role","group"),m.className="jstree-children",a.appendChild(m)),a=m,o<a.childNodes.length?a.insertBefore(t,a.childNodes[o]):a.appendChild(t),g&&(v=this.element[0].scrollTop,y=this.element[0].scrollLeft,t.childNodes[1].focus(),this.element[0].scrollTop=v,this.element[0].scrollLeft=y)}return s.state.opened&&!s.state.loaded&&(s.state.opened=!1,setTimeout(e.proxy(function(){this.open_node(s.id,!1,0)},this),0)),t},open_node:function(i,r,n){var s,a,o,d;if(e.isArray(i)){for(i=i.slice(),s=0,a=i.length;a>s;s++)this.open_node(i[s],r,n);return!0}if(!(i=this.get_node(i))||"#"===i.id)return!1;if(n=n===t?this.settings.core.animation:n,!this.is_closed(i))return r&&r.call(this,i,!1),!1;if(this.is_loaded(i))o=this.get_node(i,!0),d=this,o.length&&(n&&o.children(".jstree-children").length&&o.children(".jstree-children").stop(!0,!0),i.children.length&&!this._firstChild(o.children(".jstree-children")[0])&&this.draw_children(i),n?(this.trigger("before_open",{node:i}),o.children(".jstree-children").css("display","none").end().removeClass("jstree-closed").addClass("jstree-open").attr("aria-expanded",!0).children(".jstree-children").stop(!0,!0).slideDown(n,function(){this.style.display="",d.trigger("after_open",{node:i})})):(this.trigger("before_open",{node:i}),o[0].className=o[0].className.replace("jstree-closed","jstree-open"),o[0].setAttribute("aria-expanded",!0))),i.state.opened=!0,r&&r.call(this,i,!0),o.length||this.trigger("before_open",{node:i}),this.trigger("open_node",{node:i}),n&&o.length||this.trigger("after_open",{node:i});else{if(this.is_loading(i))return setTimeout(e.proxy(function(){this.open_node(i,r,n)},this),500);this.load_node(i,function(e,t){return t?this.open_node(e,r,n):!!r&&r.call(this,e,!1)})}},_open_to:function(t){if(!(t=this.get_node(t))||"#"===t.id)return!1;var i,r,n=t.parents;for(i=0,r=n.length;r>i;i+=1)"#"!==i&&this.open_node(n[i],!1,0);return e("#"+t.id.replace(e.jstree.idregex,"\\$&"),this.element)},close_node:function(i,r){var n,s,a,o;if(e.isArray(i)){for(i=i.slice(),n=0,s=i.length;s>n;n++)this.close_node(i[n],r);return!0}return!(!(i=this.get_node(i))||"#"===i.id)&&(!this.is_closed(i)&&(r=r===t?this.settings.core.animation:r,a=this,o=this.get_node(i,!0),o.length&&(r?o.children(".jstree-children").attr("style","display:block !important").end().removeClass("jstree-open").addClass("jstree-closed").attr("aria-expanded",!1).children(".jstree-children").stop(!0,!0).slideUp(r,function(){this.style.display="",o.children(".jstree-children").remove(),a.trigger("after_close",{node:i})}):(o[0].className=o[0].className.replace("jstree-open","jstree-closed"),o.attr("aria-expanded",!1).children(".jstree-children").remove())),i.state.opened=!1,this.trigger("close_node",{node:i}),void(r&&o.length||this.trigger("after_close",{node:i}))))},toggle_node:function(t){var i,r;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.toggle_node(t[i]);return!0}return this.is_closed(t)?this.open_node(t):this.is_open(t)?this.close_node(t):void 0},open_all:function(e,t,i){if(e||(e="#"),!(e=this.get_node(e)))return!1;var r,n,s,a="#"===e.id?this.get_container_ul():this.get_node(e,!0);if(!a.length){for(r=0,n=e.children_d.length;n>r;r++)this.is_closed(this._model.data[e.children_d[r]])&&(this._model.data[e.children_d[r]].state.opened=!0);return this.trigger("open_all",{node:e})}i=i||a,s=this,a=this.is_closed(e)?a.find(".jstree-closed").addBack():a.find(".jstree-closed"),a.each(function(){s.open_node(this,function(e,r){r&&this.is_parent(e)&&this.open_all(e,t,i)},t||0)}),0===i.find(".jstree-closed").length&&this.trigger("open_all",{node:this.get_node(i)})},close_all:function(t,i){if(t||(t="#"),!(t=this.get_node(t)))return!1;var r,n,s="#"===t.id?this.get_container_ul():this.get_node(t,!0),a=this;if(!s.length){for(r=0,n=t.children_d.length;n>r;r++)this._model.data[t.children_d[r]].state.opened=!1;return this.trigger("close_all",{node:t})}s=this.is_open(t)?s.find(".jstree-open").addBack():s.find(".jstree-open"),e(s.get().reverse()).each(function(){a.close_node(this,i||0)}),this.trigger("close_all",{node:t})},is_disabled:function(e){return(e=this.get_node(e))&&e.state&&e.state.disabled},enable_node:function(t){var i,r;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.enable_node(t[i]);return!0}return!(!(t=this.get_node(t))||"#"===t.id)&&(t.state.disabled=!1,this.get_node(t,!0).children(".jstree-anchor").removeClass("jstree-disabled").attr("aria-disabled",!1),void this.trigger("enable_node",{node:t}))},disable_node:function(t){var i,r;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.disable_node(t[i]);return!0}return!(!(t=this.get_node(t))||"#"===t.id)&&(t.state.disabled=!0,this.get_node(t,!0).children(".jstree-anchor").addClass("jstree-disabled").attr("aria-disabled",!0),void this.trigger("disable_node",{node:t}))},activate_node:function(e,i){if(this.is_disabled(e))return!1;if(this._data.core.last_clicked=this._data.core.last_clicked&&this._data.core.last_clicked.id!==t?this.get_node(this._data.core.last_clicked.id):null,this._data.core.last_clicked&&!this._data.core.last_clicked.state.selected&&(this._data.core.last_clicked=null),!this._data.core.last_clicked&&this._data.core.selected.length&&(this._data.core.last_clicked=this.get_node(this._data.core.selected[this._data.core.selected.length-1])),this.settings.core.multiple&&(i.metaKey||i.ctrlKey||i.shiftKey)&&(!i.shiftKey||this._data.core.last_clicked&&this.get_parent(e)&&this.get_parent(e)===this._data.core.last_clicked.parent))if(i.shiftKey){var r,n,s=this.get_node(e).id,a=this._data.core.last_clicked.id,o=this.get_node(this._data.core.last_clicked.parent).children,d=!1;for(r=0,n=o.length;n>r;r+=1)o[r]===s&&(d=!d),o[r]===a&&(d=!d),d||o[r]===s||o[r]===a?this.select_node(o[r],!0,!1,i):this.deselect_node(o[r],!0,i);this.trigger("changed",{action:"select_node",node:this.get_node(e),selected:this._data.core.selected,event:i})}else this.is_selected(e)?this.deselect_node(e,!1,i):this.select_node(e,!1,!1,i);else!this.settings.core.multiple&&(i.metaKey||i.ctrlKey||i.shiftKey)&&this.is_selected(e)?this.deselect_node(e,!1,i):(this.deselect_all(!0),this.select_node(e,!1,!1,i),this._data.core.last_clicked=this.get_node(e));this.trigger("activate_node",{node:this.get_node(e)})},hover_node:function(e){if(!(e=this.get_node(e,!0))||!e.length||e.children(".jstree-hovered").length)return!1;var t=this.element.find(".jstree-hovered"),i=this.element;t&&t.length&&this.dehover_node(t),e.children(".jstree-anchor").addClass("jstree-hovered"),this.trigger("hover_node",{node:this.get_node(e)}),setTimeout(function(){i.attr("aria-activedescendant",e[0].id)},0)},dehover_node:function(e){return!!((e=this.get_node(e,!0))&&e.length&&e.children(".jstree-hovered").length)&&(e.children(".jstree-anchor").removeClass("jstree-hovered"),void this.trigger("dehover_node",{node:this.get_node(e)}))},select_node:function(t,i,r,n){var s,a,o;if(e.isArray(t)){for(t=t.slice(),a=0,o=t.length;o>a;a++)this.select_node(t[a],i,r,n);return!0}return!(!(t=this.get_node(t))||"#"===t.id)&&(s=this.get_node(t,!0),void(t.state.selected||(t.state.selected=!0,this._data.core.selected.push(t.id),r||(s=this._open_to(t)),s&&s.length&&s.attr("aria-selected",!0).children(".jstree-anchor").addClass("jstree-clicked"),this.trigger("select_node",{node:t,selected:this._data.core.selected,event:n}),i||this.trigger("changed",{action:"select_node",node:t,selected:this._data.core.selected,event:n}))))},deselect_node:function(t,i,r){var n,s,a;if(e.isArray(t)){for(t=t.slice(),n=0,s=t.length;s>n;n++)this.deselect_node(t[n],i,r);return!0}return!(!(t=this.get_node(t))||"#"===t.id)&&(a=this.get_node(t,!0),void(t.state.selected&&(t.state.selected=!1,this._data.core.selected=e.vakata.array_remove_item(this._data.core.selected,t.id),a.length&&a.attr("aria-selected",!1).children(".jstree-anchor").removeClass("jstree-clicked"),this.trigger("deselect_node",{node:t,selected:this._data.core.selected,event:r}),i||this.trigger("changed",{action:"deselect_node",node:t,selected:this._data.core.selected,event:r}))))},select_all:function(e){var t,i,r=this._data.core.selected.concat([]);for(this._data.core.selected=this._model.data["#"].children_d.concat(),t=0,i=this._data.core.selected.length;i>t;t++)this._model.data[this._data.core.selected[t]]&&(this._model.data[this._data.core.selected[t]].state.selected=!0);this.redraw(!0),this.trigger("select_all",{selected:this._data.core.selected}),e||this.trigger("changed",{action:"select_all",selected:this._data.core.selected,old_selection:r})},deselect_all:function(e){var t,i,r=this._data.core.selected.concat([]);for(t=0,i=this._data.core.selected.length;i>t;t++)this._model.data[this._data.core.selected[t]]&&(this._model.data[this._data.core.selected[t]].state.selected=!1);this._data.core.selected=[],this.element.find(".jstree-clicked").removeClass("jstree-clicked").parent().attr("aria-selected",!1),this.trigger("deselect_all",{selected:this._data.core.selected,node:r}),e||this.trigger("changed",{action:"deselect_all",selected:this._data.core.selected,old_selection:r})},is_selected:function(e){return!(!(e=this.get_node(e))||"#"===e.id)&&e.state.selected},get_selected:function(t){return t?e.map(this._data.core.selected,e.proxy(function(e){return this.get_node(e)},this)):this._data.core.selected.slice()},get_top_selected:function(t){var i,r,n,s,a=this.get_selected(!0),o={};for(i=0,r=a.length;r>i;i++)o[a[i].id]=a[i];for(i=0,r=a.length;r>i;i++)for(n=0,s=a[i].children_d.length;s>n;n++)o[a[i].children_d[n]]&&delete o[a[i].children_d[n]];a=[];for(i in o)o.hasOwnProperty(i)&&a.push(i);return t?e.map(a,e.proxy(function(e){return this.get_node(e)},this)):a},get_bottom_selected:function(t){var i,r,n=this.get_selected(!0),s=[];for(i=0,r=n.length;r>i;i++)n[i].children.length||s.push(n[i].id);return t?e.map(s,e.proxy(function(e){return this.get_node(e)},this)):s},get_state:function(){var e,t={core:{open:[],scroll:{left:this.element.scrollLeft(),top:this.element.scrollTop()},selected:[]}};for(e in this._model.data)this._model.data.hasOwnProperty(e)&&"#"!==e&&(this._model.data[e].state.opened&&t.core.open.push(e),this._model.data[e].state.selected&&t.core.selected.push(e));return t},set_state:function(i,r){if(i){if(i.core){var n,s,a,o;if(i.core.open)return e.isArray(i.core.open)?(n=!0,s=!1,a=this,e.each(i.core.open.concat([]),function(t,o){(s=a.get_node(o))&&(a.is_loaded(o)?(a.is_closed(o)&&a.open_node(o,!1,0),i&&i.core&&i.core.open&&e.vakata.array_remove_item(i.core.open,o)):(a.is_loading(o)||a.open_node(o,e.proxy(function(t,n){!n&&i&&i.core&&i.core.open&&e.vakata.array_remove_item(i.core.open,t.id),this.set_state(i,r)},a),0),n=!1))}),n&&(delete i.core.open,this.set_state(i,r)),!1):(delete i.core.open,this.set_state(i,r),!1);if(i.core.scroll)return i.core.scroll&&i.core.scroll.left!==t&&this.element.scrollLeft(i.core.scroll.left),i.core.scroll&&i.core.scroll.top!==t&&this.element.scrollTop(i.core.scroll.top),delete i.core.scroll,this.set_state(i,r),!1;if(i.core.selected)return o=this,this.deselect_all(),e.each(i.core.selected,function(e,t){o.select_node(t)}),delete i.core.selected,this.set_state(i,r),!1;if(e.isEmptyObject(i.core))return delete i.core,this.set_state(i,r),!1}return!e.isEmptyObject(i)||(i=null,r&&r.call(this),this.trigger("set_state"),!1)}return!1},refresh:function(t,i){this._data.core.state=!0===i?{}:this.get_state(),i&&e.isFunction(i)&&(this._data.core.state=i.call(this,this._data.core.state)),this._cnt=0,this._model.data={"#":{id:"#",parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}}};var r=this.get_container_ul()[0].className;t||(this.element.html("<ul class='"+r+"' role='group'><li class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='treeitem' id='j"+this._id+"_loading'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>"),this.element.attr("aria-activedescendant","j"+this._id+"_loading")),this.load_node("#",function(t,i){i&&(this.get_container_ul()[0].className=r,this._firstChild(this.get_container_ul()[0])&&this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id),this.set_state(e.extend(!0,{},this._data.core.state),function(){this.trigger("refresh")})),this._data.core.state=null})},refresh_node:function(t){if(!(t=this.get_node(t))||"#"===t.id)return!1;var i=[],r=[];this._data.core.selected.concat([]);r.push(t.id),!0===t.state.opened&&i.push(t.id),this.get_node(t,!0).find(".jstree-open").each(function(){i.push(this.id)}),this._load_nodes(r,e.proxy(function(e){this.open_node(i,!1,0),this.select_node(this._data.core.selected),this.trigger("refresh_node",{node:t,nodes:e})},this))},set_id:function(t,i){if(!(t=this.get_node(t))||"#"===t.id)return!1;var r,n,s=this._model.data;for(i=i.toString(),s[t.parent].children[e.inArray(t.id,s[t.parent].children)]=i,r=0,n=t.parents.length;n>r;r++)s[t.parents[r]].children_d[e.inArray(t.id,s[t.parents[r]].children_d)]=i;for(r=0,n=t.children.length;n>r;r++)s[t.children[r]].parent=i;for(r=0,n=t.children_d.length;n>r;r++)s[t.children_d[r]].parents[e.inArray(t.id,s[t.children_d[r]].parents)]=i;return r=e.inArray(t.id,this._data.core.selected),-1!==r&&(this._data.core.selected[r]=i),r=this.get_node(t.id,!0),r&&r.attr("id",i),delete s[t.id],t.id=i,s[i]=t,!0},get_text:function(e){return!(!(e=this.get_node(e))||"#"===e.id)&&e.text},set_text:function(t,i){var r,n;if(e.isArray(t)){for(t=t.slice(),r=0,n=t.length;n>r;r++)this.set_text(t[r],i);return!0}return!(!(t=this.get_node(t))||"#"===t.id)&&(t.text=i,this.get_node(t,!0).length&&this.redraw_node(t.id),this.trigger("set_text",{obj:t,text:i}),!0)},get_json:function(t,i,r){if(!(t=this.get_node(t||"#")))return!1;i&&i.flat&&!r&&(r=[]);var n,s,a={id:t.id,text:t.text,icon:this.get_icon(t),li_attr:e.extend(!0,{},t.li_attr),a_attr:e.extend(!0,{},t.a_attr),state:{},data:(!i||!i.no_data)&&e.extend(!0,{},t.data)};if(i&&i.flat?a.parent=t.parent:a.children=[],!i||!i.no_state)for(n in t.state)t.state.hasOwnProperty(n)&&(a.state[n]=t.state[n]);if(i&&i.no_id&&(delete a.id,a.li_attr&&a.li_attr.id&&delete a.li_attr.id,a.a_attr&&a.a_attr.id&&delete a.a_attr.id),i&&i.flat&&"#"!==t.id&&r.push(a),!i||!i.no_children)for(n=0,s=t.children.length;s>n;n++)i&&i.flat?this.get_json(t.children[n],i,r):a.children.push(this.get_json(t.children[n],i));return i&&i.flat?r:"#"===t.id?a.children:a},create_node:function(i,r,n,s,a){if(null===i&&(i="#"),!(i=this.get_node(i)))return!1;if(n=n===t?"last":n,!n.toString().match(/^(before|after)$/)&&!a&&!this.is_loaded(i))return this.load_node(i,function(){this.create_node(i,r,n,s,!0)});r||(r={text:this.get_string("New node")}),"string"==typeof r&&(r={text:r}),r.text===t&&(r.text=this.get_string("New node"));var o,d,c,h;switch("#"===i.id&&("before"===n&&(n="first"),"after"===n&&(n="last")),n){case"before":o=this.get_node(i.parent),n=e.inArray(i.id,o.children),i=o;break;case"after":o=this.get_node(i.parent),n=e.inArray(i.id,o.children)+1,i=o;break;case"inside":case"first":n=0;break;case"last":n=i.children.length;break;default:n||(n=0)}if(n>i.children.length&&(n=i.children.length),r.id||(r.id=!0),!this.check("create_node",r,i,n))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(!0===r.id&&delete r.id,!(r=this._parse_model_from_json(r,i.id,i.parents.concat())))return!1;for(o=this.get_node(r),d=[],d.push(r),d=d.concat(o.children_d),this.trigger("model",{nodes:d,parent:i.id}),i.children_d=i.children_d.concat(d),c=0,h=i.parents.length;h>c;c++)this._model.data[i.parents[c]].children_d=this._model.data[i.parents[c]].children_d.concat(d);for(r=o,o=[],c=0,h=i.children.length;h>c;c++)o[c>=n?c+1:c]=i.children[c];return o[n]=r.id,i.children=o,this.redraw_node(i,!0),s&&s.call(this,this.get_node(r)),this.trigger("create_node",{node:this.get_node(r),parent:i.id,position:n}),r.id},rename_node:function(t,i){var r,n,s;if(e.isArray(t)){for(t=t.slice(),r=0,n=t.length;n>r;r++)this.rename_node(t[r],i);return!0}return!(!(t=this.get_node(t))||"#"===t.id)&&(s=t.text,this.check("rename_node",t,this.get_parent(t),i)?(this.set_text(t,i),this.trigger("rename_node",{node:t,text:i,old:s}),!0):(this.settings.core.error.call(this,this._data.core.last_error),!1))},delete_node:function(t){var i,r,n,s,a,o,d,c,h,l;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.delete_node(t[i]);return!0}if(!(t=this.get_node(t))||"#"===t.id)return!1;if(n=this.get_node(t.parent),s=e.inArray(t.id,n.children),l=!1,!this.check("delete_node",t,n,s))return this.settings.core.error.call(this,this._data.core.last_error),!1;for(-1!==s&&(n.children=e.vakata.array_remove(n.children,s)),a=t.children_d.concat([]),a.push(t.id),c=0,h=a.length;h>c;c++){for(o=0,d=t.parents.length;d>o;o++)-1!==(s=e.inArray(a[c],this._model.data[t.parents[o]].children_d))&&(this._model.data[t.parents[o]].children_d=e.vakata.array_remove(this._model.data[t.parents[o]].children_d,s));this._model.data[a[c]].state.selected&&(l=!0,-1!==(s=e.inArray(a[c],this._data.core.selected))&&(this._data.core.selected=e.vakata.array_remove(this._data.core.selected,s)))}for(this.trigger("delete_node",{node:t,parent:n.id}),l&&this.trigger("changed",{action:"delete_node",node:t,selected:this._data.core.selected,parent:n.id}),c=0,h=a.length;h>c;c++)delete this._model.data[a[c]];return this.redraw_node(n,!0),!0},check:function(t,i,r,n,s){i=i&&i.id?i:this.get_node(i),r=r&&r.id?r:this.get_node(r);var a=t.match(/^move_node|copy_node|create_node$/i)?r:i,o=this.settings.core.check_callback;return"move_node"!==t&&"copy_node"!==t||s&&s.is_multi||i.id!==r.id&&e.inArray(i.id,r.children)!==n&&-1===e.inArray(r.id,i.children_d)?(a&&a.data&&(a=a.data),a&&a.functions&&(!1===a.functions[t]||!0===a.functions[t])?(!1===a.functions[t]&&(this._data.core.last_error={error:"check",plugin:"core",id:"core_02",reason:"Node data prevents function: "+t,data:JSON.stringify({chk:t,pos:n,obj:!(!i||!i.id)&&i.id,par:!(!r||!r.id)&&r.id})}),a.functions[t]):!(!1===o||e.isFunction(o)&&!1===o.call(this,t,i,r,n,s)||o&&!1===o[t])||(this._data.core.last_error={error:"check",plugin:"core",id:"core_03",reason:"User config for core.check_callback prevents function: "+t,data:JSON.stringify({chk:t,pos:n,obj:!(!i||!i.id)&&i.id,par:!(!r||!r.id)&&r.id})},!1)):(this._data.core.last_error={error:"check",plugin:"core",id:"core_01",reason:"Moving parent inside child",data:JSON.stringify({chk:t,pos:n,obj:!(!i||!i.id)&&i.id,par:!(!r||!r.id)&&r.id})},!1)},last_error:function(){return this._data.core.last_error},move_node:function(i,r,n,s,a,o){var d,c,h,l,u,_,p,f,g,m,v,y,x,b;if(r=this.get_node(r),n=n===t?0:n,!r)return!1;if(!n.toString().match(/^(before|after)$/)&&!a&&!this.is_loaded(r))return this.load_node(r,function(){this.move_node(i,r,n,s,!0)});if(e.isArray(i)){for(i=i.slice(),d=0,c=i.length;c>d;d++)this.move_node(i[d],r,n,s,a,!0)&&(r=i[d],n="after");return this.redraw(),!0}if(!(i=i&&i.id?i:this.get_node(i))||"#"===i.id)return!1;if(h=(i.parent||"#").toString(),u=n.toString().match(/^(before|after)$/)&&"#"!==r.id?this.get_node(r.parent):r,_=i.instance?i.instance:this._model.data[i.id]?this:e.jstree.reference(i.id),p=!_||!_._id||this._id!==_._id,l=_&&_._id&&h&&_._model.data[h]&&_._model.data[h].children?e.inArray(i.id,_._model.data[h].children):-1,p)return!!this.copy_node(i,r,n,s,a)&&(_&&_.delete_node(i),!0);switch("#"===r.id&&("before"===n&&(n="first"),"after"===n&&(n="last")),n){case"before":n=e.inArray(r.id,u.children);break;case"after":n=e.inArray(r.id,u.children)+1;break;case"inside":case"first":n=0;break;case"last":n=u.children.length;break;default:n||(n=0)}if(n>u.children.length&&(n=u.children.length),!this.check("move_node",i,u,n,{core:!0,is_multi:_&&_._id&&_._id!==this._id,is_foreign:!_||!_._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(i.parent===u.id){for(f=u.children.concat(),g=e.inArray(i.id,f),-1!==g&&(f=e.vakata.array_remove(f,g),n>g&&n--),g=[],m=0,v=f.length;v>m;m++)g[m>=n?m+1:m]=f[m];g[n]=i.id,u.children=g,this._node_changed(u.id),this.redraw("#"===u.id)}else{for(g=i.children_d.concat(),g.push(i.id),m=0,v=i.parents.length;v>m;m++){for(f=[],b=_._model.data[i.parents[m]].children_d,y=0,x=b.length;x>y;y++)-1===e.inArray(b[y],g)&&f.push(b[y]);_._model.data[i.parents[m]].children_d=f}for(_._model.data[h].children=e.vakata.array_remove_item(_._model.data[h].children,i.id),m=0,v=u.parents.length;v>m;m++)this._model.data[u.parents[m]].children_d=this._model.data[u.parents[m]].children_d.concat(g);for(f=[],m=0,v=u.children.length;v>m;m++)f[m>=n?m+1:m]=u.children[m];for(f[n]=i.id,u.children=f,u.children_d.push(i.id),u.children_d=u.children_d.concat(i.children_d),i.parent=u.id,g=u.parents.concat(),g.unshift(u.id),b=i.parents.length,i.parents=g,g=g.concat(),m=0,v=i.children_d.length;v>m;m++)this._model.data[i.children_d[m]].parents=this._model.data[i.children_d[m]].parents.slice(0,-1*b),Array.prototype.push.apply(this._model.data[i.children_d[m]].parents,g);("#"===h||"#"===u.id)&&(this._model.force_full_redraw=!0),this._model.force_full_redraw||(this._node_changed(h),this._node_changed(u.id)),o||this.redraw()}return s&&s.call(this,i,u,n),this.trigger("move_node",{node:i,parent:u.id,position:n,old_parent:h,old_position:l,is_multi:_&&_._id&&_._id!==this._id,is_foreign:!_||!_._id,old_instance:_,new_instance:this}),!0},copy_node:function(i,r,n,s,a,o){var d,c,h,l,u,_,p,f,g,m;if(r=this.get_node(r),n=n===t?0:n,!r)return!1;if(!n.toString().match(/^(before|after)$/)&&!a&&!this.is_loaded(r))return this.load_node(r,function(){this.copy_node(i,r,n,s,!0)});if(e.isArray(i)){for(i=i.slice(),d=0,c=i.length;c>d;d++)(l=this.copy_node(i[d],r,n,s,a,!0))&&(r=l,n="after");return this.redraw(),!0}if(!(i=i&&i.id?i:this.get_node(i))||"#"===i.id)return!1;switch(f=(i.parent||"#").toString(),g=n.toString().match(/^(before|after)$/)&&"#"!==r.id?this.get_node(r.parent):r,m=i.instance?i.instance:this._model.data[i.id]?this:e.jstree.reference(i.id),!m||!m._id||this._id!==m._id,"#"===r.id&&("before"===n&&(n="first"),"after"===n&&(n="last")),n){case"before":n=e.inArray(r.id,g.children);break;case"after":n=e.inArray(r.id,g.children)+1;break;case"inside":case"first":n=0;break;case"last":n=g.children.length;break;default:n||(n=0)}if(n>g.children.length&&(n=g.children.length),!this.check("copy_node",i,g,n,{core:!0,is_multi:m&&m._id&&m._id!==this._id,is_foreign:!m||!m._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(!(p=m?m.get_json(i,{no_id:!0,no_data:!0,no_state:!0}):i))return!1;if(!0===p.id&&delete p.id,!(p=this._parse_model_from_json(p,g.id,g.parents.concat())))return!1;for(l=this.get_node(p),i&&i.state&&!1===i.state.loaded&&(l.state.loaded=!1),h=[],h.push(p),h=h.concat(l.children_d),this.trigger("model",{nodes:h,parent:g.id}),u=0,_=g.parents.length;_>u;u++)this._model.data[g.parents[u]].children_d=this._model.data[g.parents[u]].children_d.concat(h);for(h=[],u=0,_=g.children.length;_>u;u++)h[u>=n?u+1:u]=g.children[u];return h[n]=l.id,g.children=h,g.children_d.push(l.id),g.children_d=g.children_d.concat(l.children_d),"#"===g.id&&(this._model.force_full_redraw=!0),this._model.force_full_redraw||this._node_changed(g.id),o||this.redraw("#"===g.id),s&&s.call(this,l,g,n),this.trigger("copy_node",{node:l,original:i,parent:g.id,position:n,old_parent:f,old_position:m&&m._id&&f&&m._model.data[f]&&m._model.data[f].children?e.inArray(i.id,m._model.data[f].children):-1,is_multi:m&&m._id&&m._id!==this._id,is_foreign:!m||!m._id,old_instance:m,new_instance:this}),l.id},cut:function(t){if(t||(t=this._data.core.selected.concat()),e.isArray(t)||(t=[t]),!t.length)return!1;var i,r,n,d=[];for(r=0,n=t.length;n>r;r++)(i=this.get_node(t[r]))&&i.id&&"#"!==i.id&&d.push(i);return!!d.length&&(s=d,o=this,a="move_node",void this.trigger("cut",{node:t}))},copy:function(t){if(t||(t=this._data.core.selected.concat()),e.isArray(t)||(t=[t]),!t.length)return!1;var i,r,n,d=[];for(r=0,n=t.length;n>r;r++)(i=this.get_node(t[r]))&&i.id&&"#"!==i.id&&d.push(i);return!!d.length&&(s=d,o=this,a="copy_node",void this.trigger("copy",{node:t}))},get_buffer:function(){return{mode:a,node:s,inst:o}},can_paste:function(){return!1!==a&&!1!==s},paste:function(e,t){return!!((e=this.get_node(e))&&a&&a.match(/^(copy_node|move_node)$/)&&s)&&(this[a](s,e,t)&&this.trigger("paste",{parent:e.id,node:s,mode:a}),s=!1,a=!1,void(o=!1))},clear_buffer:function(){s=!1,a=!1,o=!1,this.trigger("clear_buffer")},edit:function(t,i){if(!(t=this.get_node(t)))return!1;if(!1===this.settings.core.check_callback)return this._data.core.last_error={error:"check",plugin:"core",id:"core_07",reason:"Could not edit node because of check_callback"},this.settings.core.error.call(this,this._data.core.last_error),!1;i="string"==typeof i?i:t.text,this.set_text(t,""),t.text=i,t=this._open_to(t);var r=this._data.core.rtl,n=this.element.width(),s=t.children(".jstree-anchor"),a=e("<span>"),o=i,d=e("<div />",{css:{position:"absolute",top:"-200px",left:r?"0px":"-1000px",visibility:"hidden"}}).appendTo("body"),c=e("<input />",{value:o,class:"jstree-rename-input",css:{padding:"0",border:"1px solid silver","box-sizing":"border-box",display:"inline-block",height:this._data.core.li_height+"px",lineHeight:this._data.core.li_height+"px",width:"150px"},blur:e.proxy(function(){var i=a.children(".jstree-rename-input"),r=i.val();""===r&&(r=o),d.remove(),a.replaceWith(s),a.remove(),this.set_text(t,o),!1===this.rename_node(t,e("<div></div>").text(r)[this.settings.core.force_text?"text":"html"]())&&this.set_text(t,o)},this),keydown:function(e){var t=e.which;27===t&&(this.value=o),(27===t||13===t||37===t||38===t||39===t||40===t||32===t)&&e.stopImmediatePropagation(),(27===t||13===t)&&(e.preventDefault(),this.blur())},click:function(e){e.stopImmediatePropagation()},mousedown:function(e){e.stopImmediatePropagation()},keyup:function(e){c.width(Math.min(d.text("pW"+this.value).width(),n))},keypress:function(e){return 13!==e.which&&void 0}}),h={fontFamily:s.css("fontFamily")||"",fontSize:s.css("fontSize")||"",fontWeight:s.css("fontWeight")||"",fontStyle:s.css("fontStyle")||"",fontStretch:s.css("fontStretch")||"",fontVariant:s.css("fontVariant")||"",letterSpacing:s.css("letterSpacing")||"",wordSpacing:s.css("wordSpacing")||""};a.attr("class",s.attr("class")).append(s.contents().clone()).append(c),s.replaceWith(a),d.css(h),c.css(h).width(Math.min(d.text("pW"+c[0].value).width(),n))[0].select()},set_theme:function(t,i){if(!t)return!1;if(!0===i){var r=this.settings.core.themes.dir;r||(r=e.jstree.path+"/themes"),i=r+"/"+t+"/style.css"}i&&-1===e.inArray(i,d)&&(e("head").append('<link rel="stylesheet" href="'+i+'" type="text/css" />'),d.push(i)),this._data.core.themes.name&&this.element.removeClass("jstree-"+this._data.core.themes.name),this._data.core.themes.name=t,this.element.addClass("jstree-"+t),this.element[this.settings.core.themes.responsive?"addClass":"removeClass"]("jstree-"+t+"-responsive"),this.trigger("set_theme",{theme:t})},get_theme:function(){return this._data.core.themes.name},set_theme_variant:function(e){this._data.core.themes.variant&&this.element.removeClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant),this._data.core.themes.variant=e,e&&this.element.addClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant)},get_theme_variant:function(){return this._data.core.themes.variant},show_stripes:function(){this._data.core.themes.stripes=!0,this.get_container_ul().addClass("jstree-striped")},hide_stripes:function(){this._data.core.themes.stripes=!1,this.get_container_ul().removeClass("jstree-striped")},toggle_stripes:function(){this._data.core.themes.stripes?this.hide_stripes():this.show_stripes()},show_dots:function(){this._data.core.themes.dots=!0,this.get_container_ul().removeClass("jstree-no-dots")},hide_dots:function(){this._data.core.themes.dots=!1,this.get_container_ul().addClass("jstree-no-dots")},toggle_dots:function(){this._data.core.themes.dots?this.hide_dots():this.show_dots()},show_icons:function(){this._data.core.themes.icons=!0,this.get_container_ul().removeClass("jstree-no-icons")},hide_icons:function(){this._data.core.themes.icons=!1,this.get_container_ul().addClass("jstree-no-icons")},toggle_icons:function(){this._data.core.themes.icons?this.hide_icons():this.show_icons()},set_icon:function(t,i){var r,n,s,a;if(e.isArray(t)){for(t=t.slice(),r=0,n=t.length;n>r;r++)this.set_icon(t[r],i);return!0}return!(!(t=this.get_node(t))||"#"===t.id)&&(a=t.icon,t.icon=i,s=this.get_node(t,!0).children(".jstree-anchor").children(".jstree-themeicon"),!1===i?this.hide_icon(t):!0===i?(s.removeClass("jstree-themeicon-custom "+a).css("background","").removeAttr("rel"),!1===a&&this.show_icon(t)):-1===i.indexOf("/")&&-1===i.indexOf(".")?(s.removeClass(a).css("background",""),s.addClass(i+" jstree-themeicon-custom").attr("rel",i),!1===a&&this.show_icon(t)):(s.removeClass(a).css("background",""),s.addClass("jstree-themeicon-custom").css("background","url('"+i+"') center center no-repeat").attr("rel",i),!1===a&&this.show_icon(t)),!0)},get_icon:function(e){return!(!(e=this.get_node(e))||"#"===e.id)&&e.icon},hide_icon:function(t){var i,r;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.hide_icon(t[i]);return!0}return!(!(t=this.get_node(t))||"#"===t)&&(t.icon=!1,this.get_node(t,!0).children(".jstree-anchor").children(".jstree-themeicon").addClass("jstree-themeicon-hidden"),!0)},show_icon:function(t){var i,r,n;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.show_icon(t[i]);return!0}return!(!(t=this.get_node(t))||"#"===t)&&(n=this.get_node(t,!0),t.icon=!n.length||n.children(".jstree-anchor").children(".jstree-themeicon").attr("rel"),t.icon||(t.icon=!0),n.children(".jstree-anchor").children(".jstree-themeicon").removeClass("jstree-themeicon-hidden"),!0)}},e.vakata={},e.vakata.attributes=function(t,i){t=e(t)[0];var r=i?{}:[];return t&&t.attributes&&e.each(t.attributes,function(t,n){-1===e.inArray(n.name.toLowerCase(),["style","contenteditable","hasfocus","tabindex"])&&null!==n.value&&""!==e.trim(n.value)&&(i?r[n.name]=n.value:r.push(n.name))}),r},e.vakata.array_unique=function(e){var t,i,r,n=[];for(t=0,r=e.length;r>t;t++){for(i=0;t>=i&&e[t]!==e[i];i++);i===t&&n.push(e[t])}return n},e.vakata.array_remove=function(e,t,i){var r=e.slice((i||t)+1||e.length);return e.length=0>t?e.length+t:t,e.push.apply(e,r),e},e.vakata.array_remove_item=function(t,i){var r=e.inArray(i,t);return-1!==r?e.vakata.array_remove(t,r):t};var u=document.createElement("I");u.className="jstree-icon jstree-checkbox",u.setAttribute("role","presentation"),e.jstree.defaults.checkbox={visible:!0,three_state:!0,whole_node:!0,keep_selected_style:!0,cascade:"",tie_selection:!0},e.jstree.plugins.checkbox=function(t,i){this.bind=function(){i.bind.call(this),this._data.checkbox.uto=!1,this._data.checkbox.selected=[],
this.settings.checkbox.three_state&&(this.settings.checkbox.cascade="up+down+undetermined"),this.element.on("init.jstree",e.proxy(function(){this._data.checkbox.visible=this.settings.checkbox.visible,this.settings.checkbox.keep_selected_style||this.element.addClass("jstree-checkbox-no-clicked"),this.settings.checkbox.tie_selection&&this.element.addClass("jstree-checkbox-selection")},this)).on("loading.jstree",e.proxy(function(){this[this._data.checkbox.visible?"show_checkboxes":"hide_checkboxes"]()},this)),-1!==this.settings.checkbox.cascade.indexOf("undetermined")&&this.element.on("changed.jstree uncheck_node.jstree check_node.jstree uncheck_all.jstree check_all.jstree move_node.jstree copy_node.jstree redraw.jstree open_node.jstree",e.proxy(function(){this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(e.proxy(this._undetermined,this),50)},this)),this.settings.checkbox.tie_selection||this.element.on("model.jstree",e.proxy(function(e,t){var i,r,n=this._model.data,s=(n[t.parent],t.nodes);for(i=0,r=s.length;r>i;i++)n[s[i]].state.checked=n[s[i]].original&&n[s[i]].original.state&&n[s[i]].original.state.checked,n[s[i]].state.checked&&this._data.checkbox.selected.push(s[i])},this)),(-1!==this.settings.checkbox.cascade.indexOf("up")||-1!==this.settings.checkbox.cascade.indexOf("down"))&&this.element.on("model.jstree",e.proxy(function(t,i){var r,n,s,a,o,d,c=this._model.data,h=c[i.parent],l=i.nodes,u=[],_=this.settings.checkbox.cascade,p=this.settings.checkbox.tie_selection;if(-1!==_.indexOf("down"))if(h.state[p?"selected":"checked"]){for(n=0,s=l.length;s>n;n++)c[l[n]].state[p?"selected":"checked"]=!0;this._data[p?"core":"checkbox"].selected=this._data[p?"core":"checkbox"].selected.concat(l)}else for(n=0,s=l.length;s>n;n++)if(c[l[n]].state[p?"selected":"checked"]){for(a=0,o=c[l[n]].children_d.length;o>a;a++)c[c[l[n]].children_d[a]].state[p?"selected":"checked"]=!0;this._data[p?"core":"checkbox"].selected=this._data[p?"core":"checkbox"].selected.concat(c[l[n]].children_d)}if(-1!==_.indexOf("up")){for(n=0,s=h.children_d.length;s>n;n++)c[h.children_d[n]].children.length||u.push(c[h.children_d[n]].parent);for(u=e.vakata.array_unique(u),a=0,o=u.length;o>a;a++)for(h=c[u[a]];h&&"#"!==h.id;){for(r=0,n=0,s=h.children.length;s>n;n++)r+=c[h.children[n]].state[p?"selected":"checked"];if(r!==s)break;h.state[p?"selected":"checked"]=!0,this._data[p?"core":"checkbox"].selected.push(h.id),d=this.get_node(h,!0),d&&d.length&&d.attr("aria-selected",!0).children(".jstree-anchor").addClass(p?"jstree-clicked":"jstree-checked"),h=this.get_node(h.parent)}}this._data[p?"core":"checkbox"].selected=e.vakata.array_unique(this._data[p?"core":"checkbox"].selected)},this)).on(this.settings.checkbox.tie_selection?"select_node.jstree":"check_node.jstree",e.proxy(function(t,i){var r,n,s,a,o=i.node,d=this._model.data,c=this.get_node(o.parent),h=this.get_node(o,!0),l=this.settings.checkbox.cascade,u=this.settings.checkbox.tie_selection;if(-1!==l.indexOf("down"))for(this._data[u?"core":"checkbox"].selected=e.vakata.array_unique(this._data[u?"core":"checkbox"].selected.concat(o.children_d)),r=0,n=o.children_d.length;n>r;r++)a=d[o.children_d[r]],a.state[u?"selected":"checked"]=!0,a&&a.original&&a.original.state&&a.original.state.undetermined&&(a.original.state.undetermined=!1);if(-1!==l.indexOf("up"))for(;c&&"#"!==c.id;){for(s=0,r=0,n=c.children.length;n>r;r++)s+=d[c.children[r]].state[u?"selected":"checked"];if(s!==n)break;c.state[u?"selected":"checked"]=!0,this._data[u?"core":"checkbox"].selected.push(c.id),a=this.get_node(c,!0),a&&a.length&&a.attr("aria-selected",!0).children(".jstree-anchor").addClass(u?"jstree-clicked":"jstree-checked"),c=this.get_node(c.parent)}-1!==l.indexOf("down")&&h.length&&h.find(".jstree-anchor").addClass(u?"jstree-clicked":"jstree-checked").parent().attr("aria-selected",!0)},this)).on(this.settings.checkbox.tie_selection?"deselect_all.jstree":"uncheck_all.jstree",e.proxy(function(e,t){var i,r,n,s=this.get_node("#"),a=this._model.data;for(i=0,r=s.children_d.length;r>i;i++)(n=a[s.children_d[i]])&&n.original&&n.original.state&&n.original.state.undetermined&&(n.original.state.undetermined=!1)},this)).on(this.settings.checkbox.tie_selection?"deselect_node.jstree":"uncheck_node.jstree",e.proxy(function(t,i){var r,n,s,a=i.node,o=this.get_node(a,!0),d=this.settings.checkbox.cascade,c=this.settings.checkbox.tie_selection;if(a&&a.original&&a.original.state&&a.original.state.undetermined&&(a.original.state.undetermined=!1),-1!==d.indexOf("down"))for(r=0,n=a.children_d.length;n>r;r++)s=this._model.data[a.children_d[r]],s.state[c?"selected":"checked"]=!1,s&&s.original&&s.original.state&&s.original.state.undetermined&&(s.original.state.undetermined=!1);if(-1!==d.indexOf("up"))for(r=0,n=a.parents.length;n>r;r++)s=this._model.data[a.parents[r]],s.state[c?"selected":"checked"]=!1,s&&s.original&&s.original.state&&s.original.state.undetermined&&(s.original.state.undetermined=!1),(s=this.get_node(a.parents[r],!0))&&s.length&&s.attr("aria-selected",!1).children(".jstree-anchor").removeClass(c?"jstree-clicked":"jstree-checked");for(s=[],r=0,n=this._data[c?"core":"checkbox"].selected.length;n>r;r++)-1!==d.indexOf("down")&&-1!==e.inArray(this._data[c?"core":"checkbox"].selected[r],a.children_d)||-1!==d.indexOf("up")&&-1!==e.inArray(this._data[c?"core":"checkbox"].selected[r],a.parents)||s.push(this._data[c?"core":"checkbox"].selected[r]);this._data[c?"core":"checkbox"].selected=e.vakata.array_unique(s),-1!==d.indexOf("down")&&o.length&&o.find(".jstree-anchor").removeClass(c?"jstree-clicked":"jstree-checked").parent().attr("aria-selected",!1)},this)),-1!==this.settings.checkbox.cascade.indexOf("up")&&this.element.on("delete_node.jstree",e.proxy(function(e,t){for(var i,r,n,s,a=this.get_node(t.parent),o=this._model.data,d=this.settings.checkbox.tie_selection;a&&"#"!==a.id;){for(n=0,i=0,r=a.children.length;r>i;i++)n+=o[a.children[i]].state[d?"selected":"checked"];if(n!==r)break;a.state[d?"selected":"checked"]=!0,this._data[d?"core":"checkbox"].selected.push(a.id),s=this.get_node(a,!0),s&&s.length&&s.attr("aria-selected",!0).children(".jstree-anchor").addClass(d?"jstree-clicked":"jstree-checked"),a=this.get_node(a.parent)}},this)).on("move_node.jstree",e.proxy(function(t,i){var r,n,s,a,o,d=i.is_multi,c=i.old_parent,h=this.get_node(i.parent),l=this._model.data,u=this.settings.checkbox.tie_selection;if(!d)for(r=this.get_node(c);r&&"#"!==r.id;){for(n=0,s=0,a=r.children.length;a>s;s++)n+=l[r.children[s]].state[u?"selected":"checked"];if(n!==a)break;r.state[u?"selected":"checked"]=!0,this._data[u?"core":"checkbox"].selected.push(r.id),o=this.get_node(r,!0),o&&o.length&&o.attr("aria-selected",!0).children(".jstree-anchor").addClass(u?"jstree-clicked":"jstree-checked"),r=this.get_node(r.parent)}for(r=h;r&&"#"!==r.id;){for(n=0,s=0,a=r.children.length;a>s;s++)n+=l[r.children[s]].state[u?"selected":"checked"];if(n===a)r.state[u?"selected":"checked"]||(r.state[u?"selected":"checked"]=!0,this._data[u?"core":"checkbox"].selected.push(r.id),(o=this.get_node(r,!0))&&o.length&&o.attr("aria-selected",!0).children(".jstree-anchor").addClass(u?"jstree-clicked":"jstree-checked"));else{if(!r.state[u?"selected":"checked"])break;r.state[u?"selected":"checked"]=!1,this._data[u?"core":"checkbox"].selected=e.vakata.array_remove_item(this._data[u?"core":"checkbox"].selected,r.id),(o=this.get_node(r,!0))&&o.length&&o.attr("aria-selected",!1).children(".jstree-anchor").removeClass(u?"jstree-clicked":"jstree-checked")}r=this.get_node(r.parent)}},this))},this._undetermined=function(){var t,i,r=this._model.data,n=this.settings.checkbox.tie_selection,s=this._data[n?"core":"checkbox"].selected,a=[],o=this;for(t=0,i=s.length;i>t;t++)r[s[t]]&&r[s[t]].parents&&(a=a.concat(r[s[t]].parents));for(this.element.find(".jstree-closed").not(":has(.jstree-children)").each(function(){var e,n=o.get_node(this);if(n.state.loaded)for(t=0,i=n.children_d.length;i>t;t++)e=r[n.children_d[t]],!e.state.loaded&&e.original&&e.original.state&&e.original.state.undetermined&&!0===e.original.state.undetermined&&(a.push(e.id),a=a.concat(e.parents));else n.original&&n.original.state&&n.original.state.undetermined&&!0===n.original.state.undetermined&&(a.push(n.id),a=a.concat(n.parents))}),a=e.vakata.array_unique(a),a=e.vakata.array_remove_item(a,"#"),this.element.find(".jstree-undetermined").removeClass("jstree-undetermined"),t=0,i=a.length;i>t;t++)r[a[t]].state[n?"selected":"checked"]||(s=this.get_node(a[t],!0))&&s.length&&s.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-undetermined")},this.redraw_node=function(t,r,n,s){if(t=i.redraw_node.apply(this,arguments)){var a,o,d=null;for(a=0,o=t.childNodes.length;o>a;a++)if(t.childNodes[a]&&t.childNodes[a].className&&-1!==t.childNodes[a].className.indexOf("jstree-anchor")){d=t.childNodes[a];break}d&&(!this.settings.checkbox.tie_selection&&this._model.data[t.id].state.checked&&(d.className+=" jstree-checked"),d.insertBefore(u.cloneNode(!1),d.childNodes[0]))}return n||-1===this.settings.checkbox.cascade.indexOf("undetermined")||(this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(e.proxy(this._undetermined,this),50)),t},this.show_checkboxes=function(){this._data.core.themes.checkboxes=!0,this.get_container_ul().removeClass("jstree-no-checkboxes")},this.hide_checkboxes=function(){this._data.core.themes.checkboxes=!1,this.get_container_ul().addClass("jstree-no-checkboxes")},this.toggle_checkboxes=function(){this._data.core.themes.checkboxes?this.hide_checkboxes():this.show_checkboxes()},this.is_undetermined=function(t){t=this.get_node(t);var i,r,n=this.settings.checkbox.cascade,s=this.settings.checkbox.tie_selection,a=this._data[s?"core":"checkbox"].selected,o=this._model.data;if(!t||!0===t.state[s?"selected":"checked"]||-1===n.indexOf("undetermined")||-1===n.indexOf("down")&&-1===n.indexOf("up"))return!1;if(!t.state.loaded&&!0===t.original.state.undetermined)return!0;for(i=0,r=t.children_d.length;r>i;i++)if(-1!==e.inArray(t.children_d[i],a)||!o[t.children_d[i]].state.loaded&&o[t.children_d[i]].original.state.undetermined)return!0;return!1},this.activate_node=function(t,r){return this.settings.checkbox.tie_selection&&(this.settings.checkbox.whole_node||e(r.target).hasClass("jstree-checkbox"))&&(r.ctrlKey=!0),this.settings.checkbox.tie_selection||!this.settings.checkbox.whole_node&&!e(r.target).hasClass("jstree-checkbox")?i.activate_node.call(this,t,r):!this.is_disabled(t)&&(this.is_checked(t)?this.uncheck_node(t,r):this.check_node(t,r),void this.trigger("activate_node",{node:this.get_node(t)}))},this.check_node=function(t,i){if(this.settings.checkbox.tie_selection)return this.select_node(t,!1,!0,i);var r,n,s;if(e.isArray(t)){for(t=t.slice(),n=0,s=t.length;s>n;n++)this.check_node(t[n],i);return!0}return!(!(t=this.get_node(t))||"#"===t.id)&&(r=this.get_node(t,!0),void(t.state.checked||(t.state.checked=!0,this._data.checkbox.selected.push(t.id),r&&r.length&&r.children(".jstree-anchor").addClass("jstree-checked"),this.trigger("check_node",{node:t,selected:this._data.checkbox.selected,event:i}))))},this.uncheck_node=function(t,i){if(this.settings.checkbox.tie_selection)return this.deselect_node(t,!1,i);var r,n,s;if(e.isArray(t)){for(t=t.slice(),r=0,n=t.length;n>r;r++)this.uncheck_node(t[r],i);return!0}return!(!(t=this.get_node(t))||"#"===t.id)&&(s=this.get_node(t,!0),void(t.state.checked&&(t.state.checked=!1,this._data.checkbox.selected=e.vakata.array_remove_item(this._data.checkbox.selected,t.id),s.length&&s.children(".jstree-anchor").removeClass("jstree-checked"),this.trigger("uncheck_node",{node:t,selected:this._data.checkbox.selected,event:i}))))},this.check_all=function(){if(this.settings.checkbox.tie_selection)return this.select_all();var e,t;this._data.checkbox.selected.concat([]);for(this._data.checkbox.selected=this._model.data["#"].children_d.concat(),e=0,t=this._data.checkbox.selected.length;t>e;e++)this._model.data[this._data.checkbox.selected[e]]&&(this._model.data[this._data.checkbox.selected[e]].state.checked=!0);this.redraw(!0),this.trigger("check_all",{selected:this._data.checkbox.selected})},this.uncheck_all=function(){if(this.settings.checkbox.tie_selection)return this.deselect_all();var e,t,i=this._data.checkbox.selected.concat([]);for(e=0,t=this._data.checkbox.selected.length;t>e;e++)this._model.data[this._data.checkbox.selected[e]]&&(this._model.data[this._data.checkbox.selected[e]].state.checked=!1);this._data.checkbox.selected=[],this.element.find(".jstree-checked").removeClass("jstree-checked"),this.trigger("uncheck_all",{selected:this._data.checkbox.selected,node:i})},this.is_checked=function(e){return this.settings.checkbox.tie_selection?this.is_selected(e):!(!(e=this.get_node(e))||"#"===e.id)&&e.state.checked},this.get_checked=function(t){return this.settings.checkbox.tie_selection?this.get_selected(t):t?e.map(this._data.checkbox.selected,e.proxy(function(e){return this.get_node(e)},this)):this._data.checkbox.selected},this.get_top_checked=function(t){if(this.settings.checkbox.tie_selection)return this.get_top_selected(t);var i,r,n,s,a=this.get_checked(!0),o={};for(i=0,r=a.length;r>i;i++)o[a[i].id]=a[i];for(i=0,r=a.length;r>i;i++)for(n=0,s=a[i].children_d.length;s>n;n++)o[a[i].children_d[n]]&&delete o[a[i].children_d[n]];a=[];for(i in o)o.hasOwnProperty(i)&&a.push(i);return t?e.map(a,e.proxy(function(e){return this.get_node(e)},this)):a},this.get_bottom_checked=function(t){if(this.settings.checkbox.tie_selection)return this.get_bottom_selected(t);var i,r,n=this.get_checked(!0),s=[];for(i=0,r=n.length;r>i;i++)n[i].children.length||s.push(n[i].id);return t?e.map(s,e.proxy(function(e){return this.get_node(e)},this)):s},this.load_node=function(t,r){var n,s,a;if(!e.isArray(t)&&!this.settings.checkbox.tie_selection&&(a=this.get_node(t))&&a.state.loaded)for(n=0,s=a.children_d.length;s>n;n++)this._model.data[a.children_d[n]].state.checked&&(!0,this._data.checkbox.selected=e.vakata.array_remove_item(this._data.checkbox.selected,a.children_d[n]));return i.load_node.apply(this,arguments)},this.get_state=function(){var e=i.get_state.apply(this,arguments);return this.settings.checkbox.tie_selection?e:(e.checkbox=this._data.checkbox.selected.slice(),e)},this.set_state=function(t,r){var n=i.set_state.apply(this,arguments);if(n&&t.checkbox){if(!this.settings.checkbox.tie_selection){this.uncheck_all();var s=this;e.each(t.checkbox,function(e,t){s.check_node(t)})}return delete t.checkbox,!1}return n}},e.jstree.defaults.contextmenu={select_node:!0,show_at_node:!0,items:function(t,i){return{create:{separator_before:!1,separator_after:!0,_disabled:!1,label:"Create",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.create_node(r,{},"last",function(e){setTimeout(function(){i.edit(e)},0)})}},rename:{separator_before:!1,separator_after:!1,_disabled:!1,label:"Rename",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.edit(r)}},remove:{separator_before:!1,icon:!1,separator_after:!1,_disabled:!1,label:"Delete",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.delete_node(i.is_selected(r)?i.get_selected():r)}},ccp:{separator_before:!0,icon:!1,separator_after:!1,label:"Edit",action:!1,submenu:{cut:{separator_before:!1,separator_after:!1,label:"Cut",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.cut(i.is_selected(r)?i.get_top_selected():r)}},copy:{separator_before:!1,icon:!1,separator_after:!1,label:"Copy",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.copy(i.is_selected(r)?i.get_top_selected():r)}},paste:{separator_before:!1,icon:!1,_disabled:function(t){return!e.jstree.reference(t.reference).can_paste()},separator_after:!1,label:"Paste",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.paste(r)}}}}}}},e.jstree.plugins.contextmenu=function(i,r){this.bind=function(){r.bind.call(this);var t,i,n=0,s=null;this.element.on("contextmenu.jstree",".jstree-anchor",e.proxy(function(e,t){e.preventDefault(),n=e.ctrlKey?+new Date:0,(t||s)&&(n=+new Date+1e4),s&&clearTimeout(s),this.is_loading(e.currentTarget)||this.show_contextmenu(e.currentTarget,e.pageX,e.pageY,e)},this)).on("click.jstree",".jstree-anchor",e.proxy(function(t){this._data.contextmenu.visible&&(!n||+new Date-n>250)&&e.vakata.context.hide(),n=0},this)).on("touchstart.jstree",".jstree-anchor",function(r){r.originalEvent&&r.originalEvent.changedTouches&&r.originalEvent.changedTouches[0]&&(t=r.pageX,i=r.pageY,s=setTimeout(function(){e(r.currentTarget).trigger("contextmenu",!0)},750))}).on("touchmove.vakata.jstree",function(e){s&&e.originalEvent&&e.originalEvent.changedTouches&&e.originalEvent.changedTouches[0]&&(Math.abs(t-e.pageX)>50||Math.abs(i-e.pageY)>50)&&clearTimeout(s)}).on("touchend.vakata.jstree",function(e){s&&clearTimeout(s)}),e(document).on("context_hide.vakata.jstree",e.proxy(function(){this._data.contextmenu.visible=!1},this))},this.teardown=function(){this._data.contextmenu.visible&&e.vakata.context.hide(),r.teardown.call(this)},this.show_contextmenu=function(i,r,n,s){if(!(i=this.get_node(i))||"#"===i.id)return!1;var a=this.settings.contextmenu,o=this.get_node(i,!0),d=o.children(".jstree-anchor"),c=!1,h=!1;(a.show_at_node||r===t||n===t)&&(c=d.offset(),r=c.left,n=c.top+this._data.core.li_height),this.settings.contextmenu.select_node&&!this.is_selected(i)&&this.activate_node(i,s),h=a.items,e.isFunction(h)&&(h=h.call(this,i,e.proxy(function(e){this._show_contextmenu(i,r,n,e)},this))),e.isPlainObject(h)&&this._show_contextmenu(i,r,n,h)},this._show_contextmenu=function(t,i,r,n){var s=this.get_node(t,!0),a=s.children(".jstree-anchor");e(document).one("context_show.vakata.jstree",e.proxy(function(t,i){var r="jstree-contextmenu jstree-"+this.get_theme()+"-contextmenu";e(i.element).addClass(r)},this)),this._data.contextmenu.visible=!0,e.vakata.context.show(a,{x:i,y:r},n),this.trigger("show_contextmenu",{node:t,x:i,y:r})}},function(e){var t=!1,i={element:!1,reference:!1,position_x:0,position_y:0,items:[],html:"",is_visible:!1};e.vakata.context={settings:{hide_onmouseleave:0,icons:!0},_trigger:function(t){e(document).triggerHandler("context_"+t+".vakata",{reference:i.reference,element:i.element,position:{x:i.position_x,y:i.position_y}})},_execute:function(t){return!(!(t=i.items[t])||t._disabled&&(!e.isFunction(t._disabled)||t._disabled({item:t,reference:i.reference,element:i.element}))||!t.action)&&t.action.call(null,{item:t,reference:i.reference,element:i.element,position:{x:i.position_x,y:i.position_y}})},_parse:function(t,r){if(!t)return!1;r||(i.html="",i.items=[]);var n,s="",a=!1;return r&&(s+="<ul>"),e.each(t,function(t,r){return!r||(i.items.push(r),!a&&r.separator_before&&(s+="<li class='vakata-context-separator'><a href='#' "+(e.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;</a></li>"),a=!1,s+="<li class='"+(r._class||"")+(!0===r._disabled||e.isFunction(r._disabled)&&r._disabled({item:r,reference:i.reference,element:i.element})?" vakata-contextmenu-disabled ":"")+"' "+(r.shortcut?" data-shortcut='"+r.shortcut+"' ":"")+">",s+="<a href='#' rel='"+(i.items.length-1)+"'>",e.vakata.context.settings.icons&&(s+="<i ",r.icon&&(s+=-1!==r.icon.indexOf("/")||-1!==r.icon.indexOf(".")?" style='background:url(\""+r.icon+"\") center center no-repeat' ":" class='"+r.icon+"' "),s+="></i><span class='vakata-contextmenu-sep'>&#160;</span>"),s+=(e.isFunction(r.label)?r.label({item:t,reference:i.reference,element:i.element}):r.label)+(r.shortcut?' <span class="vakata-contextmenu-shortcut vakata-contextmenu-shortcut-'+r.shortcut+'">'+(r.shortcut_label||"")+"</span>":"")+"</a>",r.submenu&&(n=e.vakata.context._parse(r.submenu,!0))&&(s+=n),s+="</li>",void(r.separator_after&&(s+="<li class='vakata-context-separator'><a href='#' "+(e.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;</a></li>",a=!0)))}),s=s.replace(/<li class\='vakata-context-separator'\><\/li\>$/,""),r&&(s+="</ul>"),r||(i.html=s,e.vakata.context._trigger("parse")),s.length>10&&s},_show_submenu:function(i){if(i=e(i),i.length&&i.children("ul").length){var r=i.children("ul"),n=i.offset().left+i.outerWidth(),s=i.offset().top,a=r.width(),o=r.height(),d=e(window).width()+e(window).scrollLeft(),c=e(window).height()+e(window).scrollTop();t?i[n-(a+10+i.outerWidth())<0?"addClass":"removeClass"]("vakata-context-left"):i[n+a+10>d?"addClass":"removeClass"]("vakata-context-right"),s+o+10>c&&r.css("bottom","-1px"),r.show()}},show:function(r,n,s){var a,o,d,c,h,l,u,_;switch(i.element&&i.element.length&&i.element.width(""),!0){case!n&&!r:return!1;case!!n&&!!r:i.reference=r,i.position_x=n.x,i.position_y=n.y;break;case!n&&!!r:i.reference=r,a=r.offset(),i.position_x=a.left+r.outerHeight(),i.position_y=a.top;break;case!!n&&!r:i.position_x=n.x,i.position_y=n.y}r&&!s&&e(r).data("vakata_contextmenu")&&(s=e(r).data("vakata_contextmenu")),e.vakata.context._parse(s)&&i.element.html(i.html),i.items.length&&(i.element.appendTo("body"),o=i.element,d=i.position_x,c=i.position_y,h=o.width(),l=o.height(),u=e(window).width()+e(window).scrollLeft(),_=e(window).height()+e(window).scrollTop(),t&&(d-=o.outerWidth()-e(r).outerWidth())<e(window).scrollLeft()+20&&(d=e(window).scrollLeft()+20),d+h+20>u&&(d=u-(h+20)),c+l+20>_&&(c=_-(l+20)),i.element.css({left:d,top:c}).show().find("a").first().focus().parent().addClass("vakata-context-hover"),i.is_visible=!0,e.vakata.context._trigger("show"))},hide:function(){i.is_visible&&(i.element.hide().find("ul").hide().end().find(":focus").blur().end().detach(),i.is_visible=!1,e.vakata.context._trigger("hide"))}},e(function(){t="rtl"===e("body").css("direction");var r=!1;i.element=e("<ul class='vakata-context'></ul>"),i.element.on("mouseenter","li",function(t){t.stopImmediatePropagation(),e.contains(this,t.relatedTarget)||(r&&clearTimeout(r),i.element.find(".vakata-context-hover").removeClass("vakata-context-hover").end(),e(this).siblings().find("ul").hide().end().end().parentsUntil(".vakata-context","li").addBack().addClass("vakata-context-hover"),e.vakata.context._show_submenu(this))}).on("mouseleave","li",function(t){e.contains(this,t.relatedTarget)||e(this).find(".vakata-context-hover").addBack().removeClass("vakata-context-hover")}).on("mouseleave",function(t){e(this).find(".vakata-context-hover").removeClass("vakata-context-hover"),e.vakata.context.settings.hide_onmouseleave&&(r=setTimeout(function(t){return function(){e.vakata.context.hide()}}(),e.vakata.context.settings.hide_onmouseleave))}).on("click","a",function(t){t.preventDefault(),e(this).blur().parent().hasClass("vakata-context-disabled")||!1===e.vakata.context._execute(e(this).attr("rel"))||e.vakata.context.hide()}).on("keydown","a",function(t){var r=null;switch(t.which){case 13:case 32:t.type="mouseup",t.preventDefault(),e(t.currentTarget).trigger(t);break;case 37:i.is_visible&&(i.element.find(".vakata-context-hover").last().closest("li").first().find("ul").hide().find(".vakata-context-hover").removeClass("vakata-context-hover").end().end().children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 38:i.is_visible&&(r=i.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").prevAll("li:not(.vakata-context-separator)").first(),r.length||(r=i.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").last()),r.addClass("vakata-context-hover").children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 39:i.is_visible&&(i.element.find(".vakata-context-hover").last().children("ul").show().children("li:not(.vakata-context-separator)").removeClass("vakata-context-hover").first().addClass("vakata-context-hover").children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 40:i.is_visible&&(r=i.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").nextAll("li:not(.vakata-context-separator)").first(),r.length||(r=i.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").first()),r.addClass("vakata-context-hover").children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 27:e.vakata.context.hide(),t.preventDefault()}}).on("keydown",function(e){e.preventDefault();var t=i.element.find(".vakata-contextmenu-shortcut-"+e.which).parent();t.parent().not(".vakata-context-disabled")&&t.click()}),e(document).on("mousedown.vakata.jstree",function(t){i.is_visible&&!e.contains(i.element[0],t.target)&&e.vakata.context.hide()}).on("context_show.vakata.jstree",function(e,r){i.element.find("li:has(ul)").children("a").addClass("vakata-context-parent"),t&&i.element.addClass("vakata-context-rtl").css("direction","rtl"),i.element.find("ul").hide().end()})})}(e),e.jstree.defaults.dnd={copy:!0,open_timeout:500,is_draggable:!0,check_while_dragging:!0,always_copy:!1,inside_pos:0,drag_selection:!0,touch:!0,large_drop_target:!1},e.jstree.plugins.dnd=function(t,i){this.bind=function(){i.bind.call(this),this.element.on("mousedown.jstree touchstart.jstree",".jstree-anchor",e.proxy(function(t){if("touchstart"===t.type&&(!this.settings.dnd.touch||"selected"===this.settings.dnd.touch&&!e(t.currentTarget).hasClass("jstree-clicked")))return!0;var i=this.get_node(t.target),r=this.is_selected(i)&&this.settings.dnd.drag_selection?this.get_top_selected().length:1,n=r>1?r+" "+this.get_string("nodes"):this.get_text(t.currentTarget);return this.settings.core.force_text&&(n=e("<div />").text(n).html()),i&&i.id&&"#"!==i.id&&(1===t.which||"touchstart"===t.type)&&(!0===this.settings.dnd.is_draggable||e.isFunction(this.settings.dnd.is_draggable)&&this.settings.dnd.is_draggable.call(this,r>1?this.get_top_selected(!0):[i]))?(this.element.trigger("mousedown.jstree"),e.vakata.dnd.start(t,{jstree:!0,origin:this,obj:this.get_node(i,!0),nodes:r>1?this.get_top_selected():[i.id]},'<div id="jstree-dnd" class="jstree-'+this.get_theme()+" jstree-"+this.get_theme()+"-"+this.get_theme_variant()+" "+(this.settings.core.themes.responsive?" jstree-dnd-responsive":"")+'"><i class="jstree-icon jstree-er"></i>'+n+'<ins class="jstree-copy" style="display:none;">+</ins></div>')):void 0},this))}},e(function(){var t=!1,i=!1,r=!1,n=e('<div id="jstree-marker">&#160;</div>').hide();e(document).on("dnd_start.vakata.jstree",function(e,i){t=!1,i&&i.data&&i.data.jstree&&n.appendTo("body")}).on("dnd_move.vakata.jstree",function(s,a){if(r&&clearTimeout(r),a&&a.data&&a.data.jstree&&(!a.event.target.id||"jstree-marker"!==a.event.target.id)){var o,d,c,h,l,u,_,p,f,g,m,v,y,x,b=e.jstree.reference(a.event.target),j=!1,w=!1,k=!1;if(b&&b._data&&b._data.dnd)if(n.attr("class","jstree-"+b.get_theme()+(b.settings.core.themes.responsive?" jstree-dnd-responsive":"")),a.helper.children().attr("class","jstree-"+b.get_theme()+" jstree-"+b.get_theme()+"-"+b.get_theme_variant()+" "+(b.settings.core.themes.responsive?" jstree-dnd-responsive":"")).find(".jstree-copy").first()[a.data.origin&&(a.data.origin.settings.dnd.always_copy||a.data.origin.settings.dnd.copy&&(a.event.metaKey||a.event.ctrlKey))?"show":"hide"](),a.event.target!==b.element[0]&&a.event.target!==b.get_container_ul()[0]||0!==b.get_container_ul().children().length){if((j=b.settings.dnd.large_drop_target?e(a.event.target).closest(".jstree-node").children(".jstree-anchor"):e(a.event.target).closest(".jstree-anchor"))&&j.length&&j.parent().is(".jstree-closed, .jstree-open, .jstree-leaf")&&(w=j.offset(),k=a.event.pageY-w.top,c=j.height(),u=c/3>k?["b","i","a"]:k>c-c/3?["a","i","b"]:k>c/2?["i","a","b"]:["i","b","a"],e.each(u,function(s,k){switch(k){case"b":o=w.left-6,d=w.top,h=b.get_parent(j),l=j.parent().index();break;case"i":y=b.settings.dnd.inside_pos,x=b.get_node(j.parent()),o=w.left-2,d=w.top+c/2+1,h=x.id,l="first"===y?0:"last"===y?x.children.length:Math.min(y,x.children.length);break;case"a":o=w.left-6,d=w.top+c,h=b.get_parent(j),l=j.parent().index()+1}for(_=!0,p=0,f=a.data.nodes.length;f>p;p++)if(g=a.data.origin&&(a.data.origin.settings.dnd.always_copy||a.data.origin.settings.dnd.copy&&(a.event.metaKey||a.event.ctrlKey))?"copy_node":"move_node",m=l,"move_node"===g&&"a"===k&&a.data.origin&&a.data.origin===b&&h===b.get_parent(a.data.nodes[p])&&(v=b.get_node(h),m>e.inArray(a.data.nodes[p],v.children)&&(m-=1)),!(_=_&&(b&&b.settings&&b.settings.dnd&&!1===b.settings.dnd.check_while_dragging||b.check(g,a.data.origin&&a.data.origin!==b?a.data.origin.get_node(a.data.nodes[p]):a.data.nodes[p],h,m,{dnd:!0,ref:b.get_node(j.parent()),pos:k,is_multi:a.data.origin&&a.data.origin!==b,is_foreign:!a.data.origin})))){b&&b.last_error&&(i=b.last_error());break}return"i"===k&&j.parent().is(".jstree-closed")&&b.settings.dnd.open_timeout&&(r=setTimeout(function(e,t){return function(){e.open_node(t)}}(b,j),b.settings.dnd.open_timeout)),_?(t={ins:b,par:h,pos:"i"!==k||"last"!==y||0!==l||b.is_loaded(x)?l:"last"},n.css({left:o+"px",top:d+"px"}).show(),a.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok"),i={},u=!0,!1):void 0}),!0===u))return}else{for(_=!0,p=0,f=a.data.nodes.length;f>p&&(_=_&&b.check(a.data.origin&&(a.data.origin.settings.dnd.always_copy||a.data.origin.settings.dnd.copy&&(a.event.metaKey||a.event.ctrlKey))?"copy_node":"move_node",a.data.origin&&a.data.origin!==b?a.data.origin.get_node(a.data.nodes[p]):a.data.nodes[p],"#","last",{dnd:!0,ref:b.get_node("#"),pos:"i",is_multi:a.data.origin&&a.data.origin!==b,is_foreign:!a.data.origin}));p++);if(_)return t={ins:b,par:"#",pos:"last"},n.hide(),void a.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok")}t=!1,a.helper.find(".jstree-icon").removeClass("jstree-ok").addClass("jstree-er"),n.hide()}}).on("dnd_scroll.vakata.jstree",function(e,i){i&&i.data&&i.data.jstree&&(n.hide(),t=!1,i.helper.find(".jstree-icon").first().removeClass("jstree-ok").addClass("jstree-er"))}).on("dnd_stop.vakata.jstree",function(s,a){if(r&&clearTimeout(r),a&&a.data&&a.data.jstree){n.hide().detach();var o,d,c=[];if(t){for(o=0,d=a.data.nodes.length;d>o;o++)c[o]=a.data.origin?a.data.origin.get_node(a.data.nodes[o]):a.data.nodes[o],a.data.origin&&(c[o].instance=a.data.origin);for(t.ins[a.data.origin&&(a.data.origin.settings.dnd.always_copy||a.data.origin.settings.dnd.copy&&(a.event.metaKey||a.event.ctrlKey))?"copy_node":"move_node"](c,t.par,t.pos),o=0,d=c.length;d>o;o++)c[o].instance&&(c[o].instance=null)}else o=e(a.event.target).closest(".jstree"),o.length&&i&&i.error&&"check"===i.error&&(o=o.jstree(!0))&&o.settings.core.error.call(this,i)}}).on("keyup.jstree keydown.jstree",function(t,i){(i=e.vakata.dnd._get())&&i.data&&i.data.jstree&&i.helper.find(".jstree-copy").first()[i.data.origin&&(i.data.origin.settings.dnd.always_copy||i.data.origin.settings.dnd.copy&&(t.metaKey||t.ctrlKey))?"show":"hide"]()})}),function(e){var t={element:!1,target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1};e.vakata.dnd={settings:{scroll_speed:10,scroll_proximity:20,helper_left:5,helper_top:10,threshold:5,threshold_touch:50},_trigger:function(t,i){var r=e.vakata.dnd._get();r.event=i,e(document).triggerHandler("dnd_"+t+".vakata",r)},_get:function(){return{data:t.data,element:t.element,helper:t.helper}},_clean:function(){t.helper&&t.helper.remove(),t.scroll_i&&(clearInterval(t.scroll_i),t.scroll_i=!1),t={element:!1,target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1},e(document).off("mousemove.vakata.jstree touchmove.vakata.jstree",e.vakata.dnd.drag),e(document).off("mouseup.vakata.jstree touchend.vakata.jstree",e.vakata.dnd.stop)},_scroll:function(i){if(!t.scroll_e||!t.scroll_l&&!t.scroll_t)return t.scroll_i&&(clearInterval(t.scroll_i),t.scroll_i=!1),!1
;if(!t.scroll_i)return t.scroll_i=setInterval(e.vakata.dnd._scroll,100),!1;if(!0===i)return!1;var r=t.scroll_e.scrollTop(),n=t.scroll_e.scrollLeft();t.scroll_e.scrollTop(r+t.scroll_t*e.vakata.dnd.settings.scroll_speed),t.scroll_e.scrollLeft(n+t.scroll_l*e.vakata.dnd.settings.scroll_speed),(r!==t.scroll_e.scrollTop()||n!==t.scroll_e.scrollLeft())&&e.vakata.dnd._trigger("scroll",t.scroll_e)},start:function(i,r,n){"touchstart"===i.type&&i.originalEvent&&i.originalEvent.changedTouches&&i.originalEvent.changedTouches[0]&&(i.pageX=i.originalEvent.changedTouches[0].pageX,i.pageY=i.originalEvent.changedTouches[0].pageY,i.target=document.elementFromPoint(i.originalEvent.changedTouches[0].pageX-window.pageXOffset,i.originalEvent.changedTouches[0].pageY-window.pageYOffset)),t.is_drag&&e.vakata.dnd.stop({});try{i.currentTarget.unselectable="on",i.currentTarget.onselectstart=function(){return!1},i.currentTarget.style&&(i.currentTarget.style.MozUserSelect="none")}catch(e){}return t.init_x=i.pageX,t.init_y=i.pageY,t.data=r,t.is_down=!0,t.element=i.currentTarget,t.target=i.target,t.is_touch="touchstart"===i.type,!1!==n&&(t.helper=e("<div id='vakata-dnd'></div>").html(n).css({display:"block",margin:"0",padding:"0",position:"absolute",top:"-2000px",lineHeight:"16px",zIndex:"10000"})),e(document).on("mousemove.vakata.jstree touchmove.vakata.jstree",e.vakata.dnd.drag),e(document).on("mouseup.vakata.jstree touchend.vakata.jstree",e.vakata.dnd.stop),!1},drag:function(i){if("touchmove"===i.type&&i.originalEvent&&i.originalEvent.changedTouches&&i.originalEvent.changedTouches[0]&&(i.pageX=i.originalEvent.changedTouches[0].pageX,i.pageY=i.originalEvent.changedTouches[0].pageY,i.target=document.elementFromPoint(i.originalEvent.changedTouches[0].pageX-window.pageXOffset,i.originalEvent.changedTouches[0].pageY-window.pageYOffset)),t.is_down){if(!t.is_drag){if(!(Math.abs(i.pageX-t.init_x)>(t.is_touch?e.vakata.dnd.settings.threshold_touch:e.vakata.dnd.settings.threshold)||Math.abs(i.pageY-t.init_y)>(t.is_touch?e.vakata.dnd.settings.threshold_touch:e.vakata.dnd.settings.threshold)))return;t.helper&&(t.helper.appendTo("body"),t.helper_w=t.helper.outerWidth()),t.is_drag=!0,e.vakata.dnd._trigger("start",i)}var r=!1,n=!1,s=!1,a=!1,o=!1,d=!1,c=!1,h=!1,l=!1,u=!1;return t.scroll_t=0,t.scroll_l=0,t.scroll_e=!1,e(e(i.target).parentsUntil("body").addBack().get().reverse()).filter(function(){return/^auto|scroll$/.test(e(this).css("overflow"))&&(this.scrollHeight>this.offsetHeight||this.scrollWidth>this.offsetWidth)}).each(function(){var r=e(this),n=r.offset();return this.scrollHeight>this.offsetHeight&&(n.top+r.height()-i.pageY<e.vakata.dnd.settings.scroll_proximity&&(t.scroll_t=1),i.pageY-n.top<e.vakata.dnd.settings.scroll_proximity&&(t.scroll_t=-1)),this.scrollWidth>this.offsetWidth&&(n.left+r.width()-i.pageX<e.vakata.dnd.settings.scroll_proximity&&(t.scroll_l=1),i.pageX-n.left<e.vakata.dnd.settings.scroll_proximity&&(t.scroll_l=-1)),t.scroll_t||t.scroll_l?(t.scroll_e=e(this),!1):void 0}),t.scroll_e||(r=e(document),n=e(window),s=r.height(),a=n.height(),o=r.width(),d=n.width(),c=r.scrollTop(),h=r.scrollLeft(),s>a&&i.pageY-c<e.vakata.dnd.settings.scroll_proximity&&(t.scroll_t=-1),s>a&&a-(i.pageY-c)<e.vakata.dnd.settings.scroll_proximity&&(t.scroll_t=1),o>d&&i.pageX-h<e.vakata.dnd.settings.scroll_proximity&&(t.scroll_l=-1),o>d&&d-(i.pageX-h)<e.vakata.dnd.settings.scroll_proximity&&(t.scroll_l=1),(t.scroll_t||t.scroll_l)&&(t.scroll_e=r)),t.scroll_e&&e.vakata.dnd._scroll(!0),t.helper&&(l=parseInt(i.pageY+e.vakata.dnd.settings.helper_top,10),u=parseInt(i.pageX+e.vakata.dnd.settings.helper_left,10),s&&l+25>s&&(l=s-50),o&&u+t.helper_w>o&&(u=o-(t.helper_w+2)),t.helper.css({left:u+"px",top:l+"px"})),e.vakata.dnd._trigger("move",i),!1}},stop:function(i){if("touchend"===i.type&&i.originalEvent&&i.originalEvent.changedTouches&&i.originalEvent.changedTouches[0]&&(i.pageX=i.originalEvent.changedTouches[0].pageX,i.pageY=i.originalEvent.changedTouches[0].pageY,i.target=document.elementFromPoint(i.originalEvent.changedTouches[0].pageX-window.pageXOffset,i.originalEvent.changedTouches[0].pageY-window.pageYOffset)),t.is_drag)e.vakata.dnd._trigger("stop",i);else if("touchend"===i.type&&i.target===t.target){var r=setTimeout(function(){e(i.target).click()},100);e(i.target).one("click",function(){r&&clearTimeout(r)})}return e.vakata.dnd._clean(),!1}}}(e),e.jstree.defaults.search={ajax:!1,fuzzy:!1,case_sensitive:!1,show_only_matches:!1,close_opened_onclear:!0,search_leaves_only:!1,search_callback:!1},e.jstree.plugins.search=function(i,r){this.bind=function(){r.bind.call(this),this._data.search.str="",this._data.search.dom=e(),this._data.search.res=[],this._data.search.opn=[],this._data.search.som=!1,this.element.on("before_open.jstree",e.proxy(function(t,i){var r,n,s=this._data.search.res,a=[],o=e();if(s&&s.length&&(this._data.search.dom=e(this.element[0].querySelectorAll("#"+e.map(s,function(t){return-1!=="0123456789".indexOf(t[0])?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.dom.children(".jstree-anchor").addClass("jstree-search"),this._data.search.som&&this._data.search.res.length)){for(r=0,n=s.length;n>r;r++)a=a.concat(this.get_node(s[r]).parents);a=e.vakata.array_remove_item(e.vakata.array_unique(a),"#"),o=a.length?e(this.element[0].querySelectorAll("#"+e.map(a,function(t){return-1!=="0123456789".indexOf(t[0])?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")}).join(", #"))):e(),this.element.find(".jstree-node").hide().filter(".jstree-last").filter(function(){return this.nextSibling}).removeClass("jstree-last"),o=o.add(this._data.search.dom),o.parentsUntil(".jstree").addBack().show().filter(".jstree-children").each(function(){e(this).children(".jstree-node:visible").eq(-1).addClass("jstree-last")})}},this)).on("search.jstree",e.proxy(function(t,i){this._data.search.som&&i.nodes.length&&(this.element.find(".jstree-node").hide().filter(".jstree-last").filter(function(){return this.nextSibling}).removeClass("jstree-last"),i.nodes.parentsUntil(".jstree").addBack().show().filter(".jstree-children").each(function(){e(this).children(".jstree-node:visible").eq(-1).addClass("jstree-last")}))},this)).on("clear_search.jstree",e.proxy(function(e,t){this._data.search.som&&t.nodes.length&&this.element.find(".jstree-node").css("display","").filter(".jstree-last").filter(function(){return this.nextSibling}).removeClass("jstree-last")},this))},this.search=function(i,r,n){if(!1===i||""===e.trim(i.toString()))return this.clear_search();i=i.toString();var s=this.settings.search,a=!!s.ajax&&s.ajax,o=null,d=[],c=[];return this._data.search.res.length&&this.clear_search(),n===t&&(n=s.show_only_matches),r||!1===a?(this._data.search.str=i,this._data.search.dom=e(),this._data.search.res=[],this._data.search.opn=[],this._data.search.som=n,o=new e.vakata.search(i,!0,{caseSensitive:s.case_sensitive,fuzzy:s.fuzzy}),e.each(this._model.data,function(e,t){t.text&&(s.search_callback&&s.search_callback.call(this,i,t)||!s.search_callback&&o.search(t.text).isMatch)&&(!s.search_leaves_only||t.state.loaded&&0===t.children.length)&&(d.push(e),c=c.concat(t.parents))}),d.length&&(c=e.vakata.array_unique(c),this._search_open(c),this._data.search.dom=e(this.element[0].querySelectorAll("#"+e.map(d,function(t){return-1!=="0123456789".indexOf(t[0])?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.res=d,this._data.search.dom.children(".jstree-anchor").addClass("jstree-search")),void this.trigger("search",{nodes:this._data.search.dom,str:i,res:this._data.search.res,show_only_matches:n})):e.isFunction(a)?a.call(this,i,e.proxy(function(t){t&&t.d&&(t=t.d),this._load_nodes(e.isArray(t)?e.vakata.array_unique(t):[],function(){this.search(i,!0,n)},!0)},this)):(a=e.extend({},a),a.data||(a.data={}),a.data.str=i,e.ajax(a).fail(e.proxy(function(){this._data.core.last_error={error:"ajax",plugin:"search",id:"search_01",reason:"Could not load search parents",data:JSON.stringify(a)},this.settings.core.error.call(this,this._data.core.last_error)},this)).done(e.proxy(function(t){t&&t.d&&(t=t.d),this._load_nodes(e.isArray(t)?e.vakata.array_unique(t):[],function(){this.search(i,!0,n)},!0)},this)))},this.clear_search=function(){this._data.search.dom.children(".jstree-anchor").removeClass("jstree-search"),this.settings.search.close_opened_onclear&&this.close_node(this._data.search.opn,0),this.trigger("clear_search",{nodes:this._data.search.dom,str:this._data.search.str,res:this._data.search.res}),this._data.search.str="",this._data.search.res=[],this._data.search.opn=[],this._data.search.dom=e()},this._search_open=function(t){var i=this;e.each(t.concat([]),function(r,n){if("#"===n)return!0;try{n=e("#"+n.replace(e.jstree.idregex,"\\$&"),i.element)}catch(e){}n&&n.length&&i.is_closed(n)&&(i._data.search.opn.push(n[0].id),i.open_node(n,function(){i._search_open(t)},0))})}},function(e){e.vakata.search=function(e,t,i){i=i||{},!1!==i.fuzzy&&(i.fuzzy=!0),e=i.caseSensitive?e:e.toLowerCase();var r,n,s,a,o=i.location||0,d=i.distance||100,c=i.threshold||.6,h=e.length;return h>32&&(i.fuzzy=!1),i.fuzzy&&(r=1<<h-1,n=function(){var t={},i=0;for(i=0;h>i;i++)t[e.charAt(i)]=0;for(i=0;h>i;i++)t[e.charAt(i)]|=1<<h-i-1;return t}(),s=function(e,t){var i=e/h,r=Math.abs(o-t);return d?i+r/d:r?1:i}),a=function(t){if(t=i.caseSensitive?t:t.toLowerCase(),e===t||-1!==t.indexOf(e))return{isMatch:!0,score:0};if(!i.fuzzy)return{isMatch:!1,score:1};var a,d,l,u,_,p,f,g,m,v=t.length,y=c,x=t.indexOf(e,o),b=h+v,j=1,w=[];for(-1!==x&&(y=Math.min(s(0,x),y),-1!==(x=t.lastIndexOf(e,o+h))&&(y=Math.min(s(0,x),y))),x=-1,a=0;h>a;a++){for(l=0,u=b;u>l;)s(a,o+u)<=y?l=u:b=u,u=Math.floor((b-l)/2+l);for(b=u,p=Math.max(1,o-u+1),f=Math.min(o+u,v)+h,g=new Array(f+2),g[f+1]=(1<<a)-1,d=f;d>=p;d--)if(m=n[t.charAt(d-1)],g[d]=0===a?(g[d+1]<<1|1)&m:(g[d+1]<<1|1)&m|(_[d+1]|_[d])<<1|1|_[d+1],g[d]&r&&(j=s(a,d-1),y>=j)){if(y=j,x=d-1,w.push(x),!(x>o))break;p=Math.max(1,2*o-x)}if(s(a+1,o)>y)break;_=g}return{isMatch:x>=0,score:j}},!0===t?{search:a}:a(t)}}(e),e.jstree.defaults.sort=function(e,t){return this.get_text(e)>this.get_text(t)?1:-1},e.jstree.plugins.sort=function(t,i){this.bind=function(){i.bind.call(this),this.element.on("model.jstree",e.proxy(function(e,t){this.sort(t.parent,!0)},this)).on("rename_node.jstree create_node.jstree",e.proxy(function(e,t){this.sort(t.parent||t.node.parent,!1),this.redraw_node(t.parent||t.node.parent,!0)},this)).on("move_node.jstree copy_node.jstree",e.proxy(function(e,t){this.sort(t.parent,!1),this.redraw_node(t.parent,!0)},this))},this.sort=function(t,i){var r,n;if((t=this.get_node(t))&&t.children&&t.children.length&&(t.children.sort(e.proxy(this.settings.sort,this)),i))for(r=0,n=t.children_d.length;n>r;r++)this.sort(t.children_d[r],!1)}};var _=!1;e.jstree.defaults.state={key:"jstree",events:"changed.jstree open_node.jstree close_node.jstree check_node.jstree uncheck_node.jstree",ttl:!1,filter:!1},e.jstree.plugins.state=function(t,i){this.bind=function(){i.bind.call(this);var t=e.proxy(function(){this.element.on(this.settings.state.events,e.proxy(function(){_&&clearTimeout(_),_=setTimeout(e.proxy(function(){this.save_state()},this),100)},this)),this.trigger("state_ready")},this);this.element.on("ready.jstree",e.proxy(function(e,i){this.element.one("restore_state.jstree",t),this.restore_state()||t()},this))},this.save_state=function(){var t={state:this.get_state(),ttl:this.settings.state.ttl,sec:+new Date};e.vakata.storage.set(this.settings.state.key,JSON.stringify(t))},this.restore_state=function(){var t=e.vakata.storage.get(this.settings.state.key);if(t)try{t=JSON.parse(t)}catch(e){return!1}return!(t&&t.ttl&&t.sec&&+new Date-t.sec>t.ttl)&&(t&&t.state&&(t=t.state),t&&e.isFunction(this.settings.state.filter)&&(t=this.settings.state.filter.call(this,t)),!!t&&(this.element.one("set_state.jstree",function(i,r){r.instance.trigger("restore_state",{state:e.extend(!0,{},t)})}),this.set_state(t),!0))},this.clear_state=function(){return e.vakata.storage.del(this.settings.state.key)}},function(e,t){e.vakata.storage={set:function(e,t){return window.localStorage.setItem(e,t)},get:function(e){return window.localStorage.getItem(e)},del:function(e){return window.localStorage.removeItem(e)}}}(e),e.jstree.defaults.types={"#":{},default:{}},e.jstree.plugins.types=function(i,r){this.init=function(e,i){var n,s;if(i&&i.types&&i.types.default)for(n in i.types)if("default"!==n&&"#"!==n&&i.types.hasOwnProperty(n))for(s in i.types.default)i.types.default.hasOwnProperty(s)&&i.types[n][s]===t&&(i.types[n][s]=i.types.default[s]);r.init.call(this,e,i),this._model.data["#"].type="#"},this.refresh=function(e,t){r.refresh.call(this,e,t),this._model.data["#"].type="#"},this.bind=function(){this.element.on("model.jstree",e.proxy(function(e,i){var r,n,s=this._model.data,a=i.nodes,o=this.settings.types,d="default";for(r=0,n=a.length;n>r;r++)d="default",s[a[r]].original&&s[a[r]].original.type&&o[s[a[r]].original.type]&&(d=s[a[r]].original.type),s[a[r]].data&&s[a[r]].data.jstree&&s[a[r]].data.jstree.type&&o[s[a[r]].data.jstree.type]&&(d=s[a[r]].data.jstree.type),s[a[r]].type=d,!0===s[a[r]].icon&&o[d].icon!==t&&(s[a[r]].icon=o[d].icon);s["#"].type="#"},this)),r.bind.call(this)},this.get_json=function(t,i,n){var s,a,o=this._model.data,d=i?e.extend(!0,{},i,{no_id:!1}):{},c=r.get_json.call(this,t,d,n);if(!1===c)return!1;if(e.isArray(c))for(s=0,a=c.length;a>s;s++)c[s].type=c[s].id&&o[c[s].id]&&o[c[s].id].type?o[c[s].id].type:"default",i&&i.no_id&&(delete c[s].id,c[s].li_attr&&c[s].li_attr.id&&delete c[s].li_attr.id,c[s].a_attr&&c[s].a_attr.id&&delete c[s].a_attr.id);else c.type=c.id&&o[c.id]&&o[c.id].type?o[c.id].type:"default",i&&i.no_id&&(c=this._delete_ids(c));return c},this._delete_ids=function(t){if(e.isArray(t)){for(var i=0,r=t.length;r>i;i++)t[i]=this._delete_ids(t[i]);return t}return delete t.id,t.li_attr&&t.li_attr.id&&delete t.li_attr.id,t.a_attr&&t.a_attr.id&&delete t.a_attr.id,t.children&&e.isArray(t.children)&&(t.children=this._delete_ids(t.children)),t},this.check=function(i,n,s,a,o){if(!1===r.check.call(this,i,n,s,a,o))return!1;n=n&&n.id?n:this.get_node(n),s=s&&s.id?s:this.get_node(s);var d,c,h,l,u=n&&n.id?e.jstree.reference(n.id):null;switch(u=u&&u._model&&u._model.data?u._model.data:null,i){case"create_node":case"move_node":case"copy_node":if("move_node"!==i||-1===e.inArray(n.id,s.children)){if(d=this.get_rules(s),d.max_children!==t&&-1!==d.max_children&&d.max_children===s.children.length)return this._data.core.last_error={error:"check",plugin:"types",id:"types_01",reason:"max_children prevents function: "+i,data:JSON.stringify({chk:i,pos:a,obj:!(!n||!n.id)&&n.id,par:!(!s||!s.id)&&s.id})},!1;if(d.valid_children!==t&&-1!==d.valid_children&&-1===e.inArray(n.type||"default",d.valid_children))return this._data.core.last_error={error:"check",plugin:"types",id:"types_02",reason:"valid_children prevents function: "+i,data:JSON.stringify({chk:i,pos:a,obj:!(!n||!n.id)&&n.id,par:!(!s||!s.id)&&s.id})},!1;if(u&&n.children_d&&n.parents){for(c=0,h=0,l=n.children_d.length;l>h;h++)c=Math.max(c,u[n.children_d[h]].parents.length);c=c-n.parents.length+1}(0>=c||c===t)&&(c=1);do{if(d.max_depth!==t&&-1!==d.max_depth&&d.max_depth<c)return this._data.core.last_error={error:"check",plugin:"types",id:"types_03",reason:"max_depth prevents function: "+i,data:JSON.stringify({chk:i,pos:a,obj:!(!n||!n.id)&&n.id,par:!(!s||!s.id)&&s.id})},!1;s=this.get_node(s.parent),d=this.get_rules(s),c++}while(s)}}return!0},this.get_rules=function(e){if(!(e=this.get_node(e)))return!1;var i=this.get_type(e,!0);return i.max_depth===t&&(i.max_depth=-1),i.max_children===t&&(i.max_children=-1),i.valid_children===t&&(i.valid_children=-1),i},this.get_type=function(t,i){return!!(t=this.get_node(t))&&(i?e.extend({type:t.type},this.settings.types[t.type]):t.type)},this.set_type=function(i,r){var n,s,a,o,d;if(e.isArray(i)){for(i=i.slice(),s=0,a=i.length;a>s;s++)this.set_type(i[s],r);return!0}return n=this.settings.types,i=this.get_node(i),!(!n[r]||!i)&&(o=i.type,d=this.get_icon(i),i.type=r,(!0===d||n[o]&&n[o].icon!==t&&d===n[o].icon)&&this.set_icon(i,n[r].icon===t||n[r].icon),!0)}},e.jstree.defaults.unique={case_sensitive:!1,duplicate:function(e,t){return e+" ("+t+")"}},e.jstree.plugins.unique=function(i,r){this.check=function(t,i,n,s,a){if(!1===r.check.call(this,t,i,n,s,a))return!1;if(i=i&&i.id?i:this.get_node(i),!(n=n&&n.id?n:this.get_node(n))||!n.children)return!0;var o,d,c="rename_node"===t?s:i.text,h=[],l=this.settings.unique.case_sensitive,u=this._model.data;for(o=0,d=n.children.length;d>o;o++)h.push(l?u[n.children[o]].text:u[n.children[o]].text.toLowerCase());switch(l||(c=c.toLowerCase()),t){case"delete_node":return!0;case"rename_node":return o=-1===e.inArray(c,h)||i.text&&i.text[l?"toString":"toLowerCase"]()===c,o||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_01",reason:"Child with name "+c+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:s,obj:!(!i||!i.id)&&i.id,par:!(!n||!n.id)&&n.id})}),o;case"create_node":return o=-1===e.inArray(c,h),o||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_04",reason:"Child with name "+c+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:s,obj:!(!i||!i.id)&&i.id,par:!(!n||!n.id)&&n.id})}),o;case"copy_node":return o=-1===e.inArray(c,h),o||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_02",reason:"Child with name "+c+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:s,obj:!(!i||!i.id)&&i.id,par:!(!n||!n.id)&&n.id})}),o;case"move_node":return o=i.parent===n.id||-1===e.inArray(c,h),o||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_03",reason:"Child with name "+c+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:s,obj:!(!i||!i.id)&&i.id,par:!(!n||!n.id)&&n.id})}),o}return!0},this.create_node=function(i,n,s,a,o){if(!n||n.text===t){if(null===i&&(i="#"),!(i=this.get_node(i)))return r.create_node.call(this,i,n,s,a,o);if(s=s===t?"last":s,!s.toString().match(/^(before|after)$/)&&!o&&!this.is_loaded(i))return r.create_node.call(this,i,n,s,a,o);n||(n={});var d,c,h,l,u,_=this._model.data,p=this.settings.unique.case_sensitive,f=this.settings.unique.duplicate;for(c=d=this.get_string("New node"),h=[],l=0,u=i.children.length;u>l;l++)h.push(p?_[i.children[l]].text:_[i.children[l]].text.toLowerCase());for(l=1;-1!==e.inArray(p?c:c.toLowerCase(),h);)c=f.call(this,d,++l).toString();n.text=c}return r.create_node.call(this,i,n,s,a,o)}};var p=document.createElement("DIV");if(p.setAttribute("unselectable","on"),p.setAttribute("role","presentation"),p.className="jstree-wholerow",p.innerHTML="&#160;",e.jstree.plugins.wholerow=function(t,i){this.bind=function(){i.bind.call(this),this.element.on("ready.jstree set_state.jstree",e.proxy(function(){this.hide_dots()},this)).on("init.jstree loading.jstree ready.jstree",e.proxy(function(){this.get_container_ul().addClass("jstree-wholerow-ul")},this)).on("deselect_all.jstree",e.proxy(function(e,t){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked")},this)).on("changed.jstree",e.proxy(function(e,t){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked");var i,r,n=!1;for(i=0,r=t.selected.length;r>i;i++)(n=this.get_node(t.selected[i],!0))&&n.length&&n.children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("open_node.jstree",e.proxy(function(e,t){this.get_node(t.node,!0).find(".jstree-clicked").parent().children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("hover_node.jstree dehover_node.jstree",e.proxy(function(e,t){"hover_node"===e.type&&this.is_disabled(t.node)||this.get_node(t.node,!0).children(".jstree-wholerow")["hover_node"===e.type?"addClass":"removeClass"]("jstree-wholerow-hovered")},this)).on("contextmenu.jstree",".jstree-wholerow",e.proxy(function(t){t.preventDefault();var i=e.Event("contextmenu",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,pageX:t.pageX,pageY:t.pageY});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(i)},this)).on("click.jstree",".jstree-wholerow",function(t){t.stopImmediatePropagation();var i=e.Event("click",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(i).focus()}).on("click.jstree",".jstree-leaf > .jstree-ocl",e.proxy(function(t){t.stopImmediatePropagation();var i=e.Event("click",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(i).focus()},this)).on("mouseover.jstree",".jstree-wholerow, .jstree-icon",e.proxy(function(e){return e.stopImmediatePropagation(),this.is_disabled(e.currentTarget)||this.hover_node(e.currentTarget),!1},this)).on("mouseleave.jstree",".jstree-node",e.proxy(function(e){this.dehover_node(e.currentTarget)},this))},this.teardown=function(){this.settings.wholerow&&this.element.find(".jstree-wholerow").remove(),i.teardown.call(this)},this.redraw_node=function(t,r,n,s){if(t=i.redraw_node.apply(this,arguments)){var a=p.cloneNode(!0);-1!==e.inArray(t.id,this._data.core.selected)&&(a.className+=" jstree-wholerow-clicked"),this._data.core.focused&&this._data.core.focused===t.id&&(a.className+=" jstree-wholerow-hovered"),t.insertBefore(a,t.childNodes[0])}return t}},document.registerElement&&Object&&Object.create){var f=Object.create(HTMLElement.prototype);f.createdCallback=function(){var t,i={core:{},plugins:[]};for(t in e.jstree.plugins)e.jstree.plugins.hasOwnProperty(t)&&this.attributes[t]&&(i.plugins.push(t),this.getAttribute(t)&&JSON.parse(this.getAttribute(t))&&(i[t]=JSON.parse(this.getAttribute(t))));for(t in e.jstree.defaults.core)e.jstree.defaults.core.hasOwnProperty(t)&&this.attributes[t]&&(i.core[t]=JSON.parse(this.getAttribute(t))||this.getAttribute(t));e(this).jstree(i)};try{document.registerElement("vakata-jstree",{prototype:f})}catch(e){}}}});var __bind=function(e,t){return function(){return e.apply(t,arguments)}},__slice=[].slice;!function(e,t){var i,r,n,s;r=function(e){return parseFloat(e.style.width.replace("%",""))},s=function(e,t){return t=t.toFixed(2),t=t>0?t:0,e.style.width=t+"%"},n=function(e){return 0===e.type.indexOf("touch")?(e.originalEvent.touches[0]||e.originalEvent.changedTouches[0]).pageX:e.pageX},i=function(){function i(i,r){this.pointerdown=__bind(this.pointerdown,this),this.constrainWidth=__bind(this.constrainWidth,this),this.options=e.extend({},this.defaults,r),this.$table=i,this.setHeaders(),this.restoreColumnWidths(),this.syncHandleWidths(),e(t).on("resize.rc",function(e){return function(){return e.syncHandleWidths()}}(this)),this.options.start&&this.$table.bind("column:resize:start.rc",this.options.start),this.options.resize&&this.$table.bind("column:resize.rc",this.options.resize),this.options.stop&&this.$table.bind("column:resize:stop.rc",this.options.stop)}return i.prototype.defaults={selector:"tr th:visible",store:t.store,syncHandlers:!0,resizeFromBody:!0,maxWidth:null,minWidth:null},i.prototype.triggerEvent=function(t,i,r){var n;return n=e.Event(t),n.originalEvent=e.extend({},r),this.$table.trigger(n,[this].concat(i||[]))},i.prototype.getColumnId=function(e){return this.$table.data("resizable-columns-id")+"-"+e.data("resizable-column-id")},i.prototype.setHeaders=function(){return this.$tableHeaders=this.$table.find(this.options.selector),this.assignPercentageWidths(),this.createHandles()},i.prototype.destroy=function(){return this.$handleContainer.remove(),this.$table.removeData("resizableColumns"),this.$table.add(t).off(".rc")},i.prototype.assignPercentageWidths=function(){return this.$tableHeaders.each(function(t){return function(i,r){var n;return n=e(r),s(n[0],n.outerWidth()/t.$table.width()*100)}}(this))},i.prototype.createHandles=function(){var t;return null!=(t=this.$handleContainer)&&t.remove(),this.$table.before(this.$handleContainer=e("<div class='rc-handle-container' />")),this.$tableHeaders.each(function(t){return function(i,r){var n;if(0!==t.$tableHeaders.eq(i+1).length&&null==t.$tableHeaders.eq(i).attr("data-noresize")&&null==t.$tableHeaders.eq(i+1).attr("data-noresize"))return n=e("<div class='rc-handle' />"),n.data("th",e(r)),n.appendTo(t.$handleContainer)}}(this)),this.$handleContainer.on("mousedown touchstart",".rc-handle",this.pointerdown)},i.prototype.syncHandleWidths=function(){return this.$handleContainer.width(this.$table.width()).find(".rc-handle").each(function(t){return function(i,r){var n;return n=e(r),n.css({left:n.data("th").outerWidth()+(n.data("th").offset().left-t.$handleContainer.offset().left),height:t.options.resizeFromBody?t.$table.height():t.$table.find("thead").height()})}}(this))},i.prototype.saveColumnWidths=function(){return this.$tableHeaders.each(function(t){return function(i,n){var s;return s=e(n),null==s.attr("data-noresize")&&null!=t.options.store?t.options.store.set(t.getColumnId(s),r(s[0])):void 0}}(this))},i.prototype.restoreColumnWidths=function(){return this.$tableHeaders.each(function(t){return function(i,r){var n,a;return n=e(r),null!=t.options.store&&(a=t.options.store.get(t.getColumnId(n)))?s(n[0],a):void 0}}(this))},i.prototype.totalColumnWidths=function(){var t;return t=0,this.$tableHeaders.each(function(){return function(i,r){return t+=parseFloat(e(r)[0].style.width.replace("%",""))}}()),t},i.prototype.constrainWidth=function(e){return null!=this.options.minWidth&&(e=Math.max(this.options.minWidth,e)),null!=this.options.maxWidth&&(e=Math.min(this.options.maxWidth,e)),e},i.prototype.pointerdown=function(t){var i,a,o,d,c,h,l;return t.preventDefault(),o=e(t.currentTarget.ownerDocument),h=n(t),i=e(t.currentTarget),a=i.data("th"),d=this.$tableHeaders.eq(this.$tableHeaders.index(a)+1),l={left:r(a[0]),right:r(d[0])},c={left:l.left,right:l.right},this.$handleContainer.add(this.$table).addClass("rc-table-resizing"),a.add(d).add(i).addClass("rc-column-resizing"),this.triggerEvent("column:resize:start",[a,d,c.left,c.right],t),o.on("mousemove.rc touchmove.rc",function(e){return function(t){var i;return i=(n(t)-h)/e.$table.width()*100,s(a[0],c.left=e.constrainWidth(l.left+i)),s(d[0],c.right=e.constrainWidth(l.right-i)),null!=e.options.syncHandlers&&e.syncHandleWidths(),e.triggerEvent("column:resize",[a,d,c.left,c.right],t)}}(this)),o.one("mouseup touchend",function(e){return function(){return o.off("mousemove.rc touchmove.rc"),e.$handleContainer.add(e.$table).removeClass("rc-table-resizing"),a.add(d).add(i).removeClass("rc-column-resizing"),e.syncHandleWidths(),e.saveColumnWidths(),e.triggerEvent("column:resize:stop",[a,d,c.left,c.right],t)}}(this))},i}(),e.fn.extend({resizableColumns:function(){var t,r;return r=arguments[0],t=2<=arguments.length?__slice.call(arguments,1):[],this.each(function(){var n,s;return n=e(this),s=n.data("resizableColumns"),s||n.data("resizableColumns",s=new i(n,r)),"string"==typeof r?s[r].apply(s,t):void 0})}})}(window.jQuery,window),this.JSON||(this.JSON={}),function(){function f(e){return e<10?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var i,r,n,s,a,o=gap,d=t[e];switch(d&&"object"==typeof d&&"function"==typeof d.toJSON&&(d=d.toJSON(e)),"function"==typeof rep&&(d=rep.call(t,e,d)),typeof d){case"string":return quote(d);case"number":return isFinite(d)?String(d):"null";case"boolean":case"null":return String(d);case"object":if(!d)return"null";if(gap+=indent,a=[],"[object Array]"===Object.prototype.toString.apply(d)){for(s=d.length,i=0;i<s;i+=1)a[i]=str(i,d)||"null";return n=0===a.length?"[]":gap?"[\n"+gap+a.join(",\n"+gap)+"\n"+o+"]":"["+a.join(",")+"]",gap=o,n}if(rep&&"object"==typeof rep)for(s=rep.length,i=0;i<s;i+=1)"string"==typeof(r=rep[i])&&(n=str(r,d))&&a.push(quote(r)+(gap?": ":":")+n);else for(r in d)Object.hasOwnProperty.call(d,r)&&(n=str(r,d))&&a.push(quote(r)+(gap?": ":":")+n);return n=0===a.length?"{}":gap?"{\n"+gap+a.join(",\n"+gap)+"\n"+o+"}":"{"+a.join(",")+"}",gap=o,n}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b"," ":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(e,t,i){var r;if(gap="",indent="","number"==typeof i)for(r=0;r<i;r+=1)indent+=" ";else"string"==typeof i&&(indent=i);if(rep=t,!t||"function"==typeof t||"object"==typeof t&&"number"==typeof t.length)return str("",{"":e});throw new Error("JSON.stringify")}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(e,t){var i,r,n=e[t];if(n&&"object"==typeof n)for(i in n)Object.hasOwnProperty.call(n,i)&&(r=walk(n,i),void 0!==r?n[i]=r:delete n[i]);return reviver.call(e,t,n)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),function(e){function t(e){return e.replace(/^d/,"___$&").replace(h,"___")}var i,r={},n=e.document,s="localStorage",a="script";if(r.disabled=!1,r.version="1.3.17",r.set=function(e,t){},r.get=function(e,t){},r.has=function(e){return void 0!==r.get(e)},r.remove=function(e){},r.clear=function(){},r.transact=function(e,t,i){null==i&&(i=t,t=null),null==t&&(t={});var n=r.get(e,t);i(n),r.set(e,n)},r.getAll=function(){},r.forEach=function(){},r.serialize=function(e){return JSON.stringify(e)},r.deserialize=function(e){if("string"==typeof e)try{return JSON.parse(e)}catch(t){return e||void 0}},function(){try{return s in e&&e[s]}catch(e){return!1}}())i=e[s],r.set=function(e,t){return void 0===t?r.remove(e):(i.setItem(e,r.serialize(t)),t)},r.get=function(e,t){var n=r.deserialize(i.getItem(e));return void 0===n?t:n},r.remove=function(e){i.removeItem(e)},r.clear=function(){i.clear()},r.getAll=function(){var e={};return r.forEach(function(t,i){e[t]=i}),e},r.forEach=function(e){for(var t=0;t<i.length;t++){var n=i.key(t);e(n,r.get(n))}};else if(n.documentElement.addBehavior){var o,d;try{d=new ActiveXObject("htmlfile"),d.open(),d.write("<"+a+">document.w=window</"+a+'><iframe src="/favicon.ico"></iframe>'),d.close(),o=d.w.frames[0].document,i=o.createElement("div")}catch(e){i=n.createElement("div"),o=n.body}var c=function(e){return function(){var t=Array.prototype.slice.call(arguments,0);t.unshift(i),o.appendChild(i),i.addBehavior("#default#userData"),i.load(s);var n=e.apply(r,t);return o.removeChild(i),n}},h=new RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g");r.set=c(function(e,i,n){return i=t(i),void 0===n?r.remove(i):(e.setAttribute(i,r.serialize(n)),e.save(s),n)}),r.get=c(function(e,i,n){i=t(i);var s=r.deserialize(e.getAttribute(i));return void 0===s?n:s}),r.remove=c(function(e,i){i=t(i),e.removeAttribute(i),e.save(s)}),r.clear=c(function(e){var t=e.XMLDocument.documentElement.attributes;e.load(s)
;for(var i,r=0;i=t[r];r++)e.removeAttribute(i.name);e.save(s)}),r.getAll=function(e){var t={};return r.forEach(function(e,i){t[e]=i}),t},r.forEach=c(function(e,t){for(var i,n=e.XMLDocument.documentElement.attributes,s=0;i=n[s];++s)t(i.name,r.deserialize(e.getAttribute(i.name)))})}try{var l="__storejs__";r.set(l,l),r.get(l)!=l&&(r.disabled=!0),r.remove(l)}catch(e){r.disabled=!0}r.enabled=!r.disabled,"undefined"!=typeof module&&module.exports&&this.module!==module?module.exports=r:"function"==typeof define&&define.amd?define(r):e.store=r}(Function("return this")());var Tree={admin_prefix:"",parent_id:1,node:1,sortTable:function(){jQuery(".ui-sortable").sortable({scroll:!0,axis:"y",handle:".tb-sort-me-gently",update:function(e,t){var i=t.item,r=Core.urlParam("node");$.isNumeric(r)||(r=1),jQuery.ajax({url:window.location.href,type:"POST",dataType:"json",cache:!1,data:{id:i.attr("data-id"),parent_id:r,left_sibling_id:i.prev().attr("data-id"),right_sibling_id:i.next().attr("data-id"),query_type:"do_change_position"},success:function(e){1==e.status&&TableBuilder.showSuccessNotification(phrase["  "])},error:function(e,t,i){var r=jQuery.parseJSON(e.responseText);TableBuilder.showErrorNotification(r.message),TableBuilder.hidePreloader()}})}})},init:function(){Tree.initModalCallbacks(),Tree.sortTable();var e=Core.urlParam("id_tree");$.isNumeric(e)&&Tree.showEditForm(e),$("#tb-tree").on("after_open.jstree",function(e,t){}).jstree({open_parents:!0,core:{expand_selected_onload:!0,dblclick_toggle:!0,check_callback:function(e,t,i,r,n){return"move_node"!==e||"#"!==i.id}},dnd:{check_while_dragging:!0},contextmenu:{items:function(e){return{Open:{label:"",action:function(e){window.location.href=window.location.origin+window.location.pathname+"?node="+$(e.reference[0].parentElement).data("id")},separator_after:!0},Create:{label:"",action:function(e){console.log($(e.reference[0].parentElement).data("id")),Tree.showCreateForm($(e.reference[0].parentElement).data("id"))}},Rename:{label:"",action:function(e){Tree.showEditForm($(e.reference[0].parentElement).data("id"))}},Delete:{label:"",icon:"https://cdn1.iconfinder.com/data/icons/nuove/32x32/actions/fileclose.png",action:function(e){var t=$(e.reference[0].parentElement).data("id");if(1!=t){var i=$(".node-del-"+t);Tree.doDelete(t,i),$(e.reference[0].parentElement).remove()}},separator_before:!0}}}},plugins:["dnd","search","contextmenu"]}).bind("move_node.jstree",function(e,t){var i=jQuery("#"+t.node.id);jQuery.ajax({url:window.location.href,type:"POST",dataType:"json",cache:!1,data:{id:i.data("id"),parent_id:jQuery("#"+t.parent).data("id"),left_sibling_id:i.prev().data("id"),right_sibling_id:i.next().data("id"),query_type:"do_change_position"},success:function(e){e.status&&(i.data("parent-id",e.parent_id),Tree.setdbl())}})}).bind("select_node.jstree",function(e,t){void 0!==t.rslt&&t.rslt.obj.parents(".jstree-closed").each(function(){t.inst.open_node(this)})}).bind("dblclick.jstree",function(e){var t=$(e.target).closest("li");window.location.href=window.location.origin+window.location.pathname+"?node="+t.context.parentElement.dataset.id})},activeToggle:function(e,t){t=t?1:0,jQuery.ajax({url:window.location.href,type:"POST",dataType:"json",cache:!1,data:{id:e,is_active:t,query_type:"do_change_active_status"},success:function(e){},error:function(e,t,i){var r=jQuery.parseJSON(e.responseText);TableBuilder.showErrorNotification(r.message),TableBuilder.hidePreloader()}})},activeSetToggle:function(e,t){var i=$(e).closest("table"),r=i.parent().find(".node-active-smoke-lol");r.show();var n=i.find(":input").serializeArray();n.push({name:"id",value:t}),n.push({name:"query_type",value:"do_change_active_status"}),console.table(n),jQuery.ajax({url:window.location.href,type:"POST",dataType:"json",cache:!1,data:n,success:function(e){r.hide()}})},showCreateForm:function(e){$("#cf-node","#tree-create-modal").val(e),$("#tree-create-modal").modal("show")},initModalCallbacks:function(){$("#tree-create-modal").on("hidden.bs.modal",function(){$("#cf-node").val(""),$("#tree-create-modal-form")[0].reset()})},doCreateNode:function(){var e=$("#tree-create-modal-form").serializeArray();e.push({name:"query_type",value:"do_create_node"}),$("#tree-create-modal").modal("hide"),jQuery.ajax({url:window.location.href,type:"POST",dataType:"json",cache:!1,data:e,success:function(e){e.status?doAjaxLoadContent(location.href):TableBuilder.showErrorNotification(phrase["-   ,  "])},error:function(e,t,i){var r=jQuery.parseJSON(e.responseText);TableBuilder.showErrorNotification(r.message),TableBuilder.hidePreloader()}})},getCloneForm:function(e,t){$.post(window.location.href,{query_type:"clone_record_tree",id:e,node:t}).done(function(e){doAjaxLoadContent(location.href)}).fail(function(e,t,i){var r=jQuery.parseJSON(e.responseText);TableBuilder.showErrorNotification(r.message),TableBuilder.hidePreloader()})},showEditForm:function(e){TableBuilder.showPreloader();var t="?id_tree="+e,i=Core.urlParam("node");$.isNumeric(i)&&(t+="&node="+i),window.history.pushState(t,"",t),jQuery.ajax({url:window.location.href,type:"POST",dataType:"json",cache:!1,data:{id:e,query_type:"get_edit_modal_form"},success:function(e){e.status?(jQuery(TableBuilder.form_wrapper).html(e.html),TableBuilder.initFroalaEditor(),jQuery(TableBuilder.form_edit).modal("show").css("top",$(window).scrollTop()),jQuery(TableBuilder.form_edit).find("input[data-mask]").each(function(){var e=jQuery(this);e.mask(e.attr("data-mask"))}),TableBuilder.handleActionSelect(),$(".modal-dialog").draggable({handle:".modal-header"})):TableBuilder.showErrorNotification(phrase["-   ,  "]),TableBuilder.hidePreloader()},error:function(e,t,i){var r=jQuery.parseJSON(e.responseText);TableBuilder.showErrorNotification(r.message),TableBuilder.hidePreloader()}})},doEdit:function(e,t){var i="#edit_form_"+t;TableBuilder.edit_form=i,TableBuilder.action_url=$(i).attr("action"),TableBuilder.showPreloader(),TableBuilder.showFormPreloader(TableBuilder.form_edit),$(TableBuilder.edit_form+" .fr-link-insert-layer input").each(function(e){$(this).removeAttr("name")});var r=jQuery(TableBuilder.edit_form).serializeArray();if(r.push({name:"id",value:e}),r.push({name:"query_type",value:"do_edit_node"}),0!=$(".file_multi").size()){TableBuilder.buildFiles();for(var n in TableBuilder.files){var s=TableBuilder.files[n],a=JSON.stringify(s);r.push({name:n,value:a})}}r=r.concat(jQuery(TableBuilder.edit_form).find("input[type=checkbox]:not(:checked)").map(function(){return{name:this.name,value:0}}).get());var o=[];jQuery(TableBuilder.edit_form).find('select[multiple="multiple"]').each(function(e,t){$(this).val()||o.push({name:this.name,value:""})}),r=r.concat(o),jQuery.ajax({type:"POST",url:window.location.pathname,data:r,dataType:"json",success:function(e){if(TableBuilder.hideFormPreloader(TableBuilder.form_edit),TableBuilder.destroyFroala(),e.id)TableBuilder.showSuccessNotification(phrase[""]),jQuery(TableBuilder.form_edit).modal("hide"),doAjaxLoadContent(location.href),$(document).height($(window).height());else{var t="";jQuery(e.errors).each(function(e,i){t+=i+"<br>"}),TableBuilder.showBigErrorNotification(t)}TableBuilder.hidePreloader()},error:function(e,t,i){var r=jQuery.parseJSON(e.responseText);TableBuilder.showErrorNotification(r.message),TableBuilder.hidePreloader()}})},doDelete:function(e,t){jQuery.SmartMessageBox({title:phrase["?"],content:phrase["    ."],buttons:"["+phrase[""]+"]["+phrase[""]+"]"},function(t){t===phrase[""]&&(TableBuilder.showPreloader(),jQuery.ajax({type:"POST",url:window.location.href,data:{id:e,query_type:"do_delete_node"},dataType:"json",success:function(t){t.status?(TableBuilder.showSuccessNotification(" "),$("tr[data-id="+e+"]").remove()):TableBuilder.showErrorNotification(phrase["-   ,  "]),TableBuilder.hidePreloader()},error:function(e,t,i){var r=jQuery.parseJSON(e.responseText);TableBuilder.showErrorNotification(r.message),TableBuilder.hidePreloader()}}))})}};jQuery(document).ready(function(){Tree.init(),$(document).on("click",".modal-header button, .modal-footer button",function(e){var t=Core.delPrm("id_tree");$(document).height($(window).height()),window.history.pushState(t,"",t)})}),function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e("object"==typeof exports?require("jquery"):jQuery)}(function(e){"use strict";function t(e){return"number"==typeof e&&!isNaN(e)}function i(e){return void 0===e}function r(e,i){var r=[];return t(i)&&r.push(i),r.slice.apply(e,r)}function n(e,t){var i=r(arguments,2);return function(){return e.apply(t,i.concat(r(arguments)))}}function s(e){var t=e.match(/^(https?:)\/\/([^\:\/\?#]+):?(\d*)/i);return t&&(t[1]!==x.protocol||t[2]!==x.hostname||t[3]!==x.port)}function a(e){var t="timestamp="+(new Date).getTime();return e+(-1===e.indexOf("?")?"?":"&")+t}function o(e){return e?' crossOrigin="'+e+'"':""}function d(e,t){var i;return e.naturalWidth&&!de?t(e.naturalWidth,e.naturalHeight):(i=document.createElement("img"),i.onload=function(){t(this.width,this.height)},void(i.src=e.src))}function c(e){var i=[],r=e.rotate,n=e.scaleX,s=e.scaleY;return t(n)&&t(s)&&i.push("scale("+n+","+s+")"),t(r)&&i.push("rotate("+r+"deg)"),i.length?i.join(" "):"none"}function h(e,t){var i,r,n=ue(e.degree)%180,s=(n>90?180-n:n)*Math.PI/180,a=_e(s),o=pe(s),d=e.width,c=e.height,h=e.aspectRatio;return t?(i=d/(o+a/h),r=i/h):(i=d*o+c*a,r=d*a+c*o),{width:i,height:r}}function l(i,r){var n,s,a,o=e("<canvas>")[0],d=o.getContext("2d"),c=0,l=0,u=r.naturalWidth,_=r.naturalHeight,p=r.rotate,f=r.scaleX,g=r.scaleY,m=t(f)&&t(g)&&(1!==f||1!==g),v=t(p)&&0!==p,y=v||m,x=u*ue(f||1),b=_*ue(g||1);return m&&(n=x/2,s=b/2),v&&(a=h({width:x,height:b,degree:p}),x=a.width,b=a.height,n=x/2,s=b/2),o.width=x,o.height=b,y&&(c=-u/2,l=-_/2,d.save(),d.translate(n,s)),m&&d.scale(f,g),v&&d.rotate(p*Math.PI/180),d.drawImage(i,me(c),me(l),me(u),me(_)),y&&d.restore(),o}function u(t){var i=t.length,r=0,n=0;return i&&(e.each(t,function(e,t){r+=t.pageX,n+=t.pageY}),r/=i,n/=i),{pageX:r,pageY:n}}function _(e,t,i){var r,n="";for(r=t,i+=t;i>r;r++)n+=ve(e.getUint8(r));return n}function p(e){var t,i,r,n,s,a,o,d,c,h,l=new k(e),u=l.byteLength;if(255===l.getUint8(0)&&216===l.getUint8(1))for(c=2;u>c;){if(255===l.getUint8(c)&&225===l.getUint8(c+1)){o=c;break}c++}if(o&&(i=o+4,r=o+10,"Exif"===_(l,i,4)&&(a=l.getUint16(r),((s=18761===a)||19789===a)&&42===l.getUint16(r+2,s)&&(n=l.getUint32(r+4,s))>=8&&(d=r+n))),d)for(u=l.getUint16(d,s),h=0;u>h;h++)if(c=d+12*h+2,274===l.getUint16(c,s)){c+=8,t=l.getUint16(c,s),de&&l.setUint16(c,1,s);break}return t}function f(e){var t,i=e.replace(Q,""),r=atob(i),n=r.length,s=new j(n),a=new w(s);for(t=0;n>t;t++)a[t]=r.charCodeAt(t);return s}function g(e){var t,i=new w(e),r=i.length,n="";for(t=0;r>t;t++)n+=ve(i[t]);return"data:image/jpeg;base64,"+C(n)}function m(t,i){this.$element=e(t),this.options=e.extend({},m.DEFAULTS,e.isPlainObject(i)&&i),this.isLoaded=!1,this.isBuilt=!1,this.isCompleted=!1,this.isRotated=!1,this.isCropped=!1,this.isDisabled=!1,this.isReplaced=!1,this.isLimited=!1,this.wheeling=!1,this.isImg=!1,this.originalUrl="",this.canvas=null,this.cropBox=null,this.init()}var v=e(window),y=e(document),x=window.location,b=window.navigator,j=window.ArrayBuffer,w=window.Uint8Array,k=window.DataView,C=window.btoa,T="cropper",O="cropper-modal",$="cropper-hide",B="cropper-hidden",S="cropper-move",N="cropper-crop",A="cropper-disabled",E="mousedown touchstart pointerdown MSPointerDown",D="mousemove touchmove pointermove MSPointerMove",P="mouseup touchend touchcancel pointerup pointercancel MSPointerUp MSPointerCancel",L="wheel mousewheel DOMMouseScroll",z="dblclick",W="load."+T,H="error."+T,M="resize."+T,X="build."+T,Y="built."+T,q="cropstart."+T,I="cropmove."+T,F="cropend."+T,J="crop."+T,U="zoom."+T,K=/e|w|s|n|se|sw|ne|nw|all|crop|move|zoom/,R=/^data\:/,Q=/^data\:([^\;]+)\;base64,/,V=/^data\:image\/jpeg.*;base64,/,Z="preview",G="action",ee="se",te="sw",ie="ne",re="nw",ne="crop",se="move",ae="zoom",oe=e.isFunction(e("<canvas>")[0].getContext),de=b&&/(Macintosh|iPhone|iPod|iPad).*AppleWebKit/i.test(b.userAgent),ce=Number,he=Math.min,le=Math.max,ue=Math.abs,_e=Math.sin,pe=Math.cos,fe=Math.sqrt,ge=Math.round,me=Math.floor,ve=String.fromCharCode;m.prototype={constructor:m,init:function(){var e,t=this.$element;if(t.is("img")){if(this.isImg=!0,this.originalUrl=e=t.attr("src"),!e)return;e=t.prop("src")}else t.is("canvas")&&oe&&(e=t[0].toDataURL());this.load(e)},trigger:function(t,i){var r=e.Event(t,i);return this.$element.trigger(r),r},load:function(t){var i,r,n=this.options,o=this.$element;if(t&&(o.one(X,n.build),!this.trigger(X).isDefaultPrevented())){if(this.url=t,this.image={},!n.checkOrientation||!j)return this.clone();if(i=e.proxy(this.read,this),R.test(t))return V.test(t)?i(f(t)):this.clone();r=new XMLHttpRequest,r.onerror=r.onabort=e.proxy(function(){this.clone()},this),r.onload=function(){i(this.response)},n.checkCrossOrigin&&s(t)&&o.prop("crossOrigin")&&(t=a(t)),r.open("get",t),r.responseType="arraybuffer",r.send()}},read:function(e){var t,i,r,n=this.options,s=p(e),a=this.image;if(s>1)switch(this.url=g(e),s){case 2:i=-1;break;case 3:t=-180;break;case 4:r=-1;break;case 5:t=90,r=-1;break;case 6:t=90;break;case 7:t=90,i=-1;break;case 8:t=-90}n.rotatable&&(a.rotate=t),n.scalable&&(a.scaleX=i,a.scaleY=r),this.clone()},clone:function(){var t,i,r=this.options,n=this.$element,d=this.url,c="";r.checkCrossOrigin&&s(d)&&(c=n.prop("crossOrigin"),c?t=d:(c="anonymous",t=a(d))),this.crossOrigin=c,this.crossOriginUrl=t,this.$clone=i=e("<img"+o(c)+' src="'+(t||d)+'">'),this.isImg?n[0].complete?this.start():n.one(W,e.proxy(this.start,this)):i.one(W,e.proxy(this.start,this)).one(H,e.proxy(this.stop,this)).addClass($).insertAfter(n)},start:function(){var t=this.$element,i=this.$clone;this.isImg||(i.off(H,this.stop),t=i),d(t[0],e.proxy(function(t,i){e.extend(this.image,{naturalWidth:t,naturalHeight:i,aspectRatio:t/i}),this.isLoaded=!0,this.build()},this))},stop:function(){this.$clone.remove(),this.$clone=null},build:function(){var t,i,r,n=this.options,s=this.$element,a=this.$clone;this.isLoaded&&(this.isBuilt&&this.unbuild(),this.$container=s.parent(),this.$cropper=t=e(m.TEMPLATE),this.$canvas=t.find(".cropper-canvas").append(a),this.$dragBox=t.find(".cropper-drag-box"),this.$cropBox=i=t.find(".cropper-crop-box"),this.$viewBox=t.find(".cropper-view-box"),this.$face=r=i.find(".cropper-face"),s.addClass(B).after(t),this.isImg||a.removeClass($),this.initPreview(),this.bind(),n.aspectRatio=le(0,n.aspectRatio)||NaN,n.viewMode=le(0,he(3,ge(n.viewMode)))||0,n.autoCrop?(this.isCropped=!0,n.modal&&this.$dragBox.addClass(O)):i.addClass(B),n.guides||i.find(".cropper-dashed").addClass(B),n.center||i.find(".cropper-center").addClass(B),n.cropBoxMovable&&r.addClass(S).data(G,"all"),n.highlight||r.addClass("cropper-invisible"),n.background&&t.addClass("cropper-bg"),n.cropBoxResizable||i.find(".cropper-line, .cropper-point").addClass(B),this.setDragMode(n.dragMode),this.render(),this.isBuilt=!0,this.setData(n.data),s.one(Y,n.built),setTimeout(e.proxy(function(){this.trigger(Y),this.trigger(J,this.getData()),this.isCompleted=!0},this),0))},unbuild:function(){this.isBuilt&&(this.isBuilt=!1,this.isCompleted=!1,this.initialImage=null,this.initialCanvas=null,this.initialCropBox=null,this.container=null,this.canvas=null,this.cropBox=null,this.unbind(),this.resetPreview(),this.$preview=null,this.$viewBox=null,this.$cropBox=null,this.$dragBox=null,this.$canvas=null,this.$container=null,this.$cropper.remove(),this.$cropper=null)},render:function(){this.initContainer(),this.initCanvas(),this.initCropBox(),this.renderCanvas(),this.isCropped&&this.renderCropBox()},initContainer:function(){var e=this.options,t=this.$element,i=this.$container,r=this.$cropper;r.addClass(B),t.removeClass(B),r.css(this.container={width:le(i.width(),ce(e.minContainerWidth)||200),height:le(i.height(),ce(e.minContainerHeight)||100)}),t.addClass(B),r.removeClass(B)},initCanvas:function(){var t,i=this.options.viewMode,r=this.container,n=r.width,s=r.height,a=this.image,o=a.naturalWidth,d=a.naturalHeight,c=90===ue(a.rotate),h=c?d:o,l=c?o:d,u=h/l,_=n,p=s;s*u>n?3===i?_=s*u:p=n/u:3===i?p=n/u:_=s*u,t={naturalWidth:h,naturalHeight:l,aspectRatio:u,width:_,height:p},t.oldLeft=t.left=(n-_)/2,t.oldTop=t.top=(s-p)/2,this.canvas=t,this.isLimited=1===i||2===i,this.limitCanvas(!0,!0),this.initialImage=e.extend({},a),this.initialCanvas=e.extend({},t)},limitCanvas:function(e,t){var i,r,n,s,a=this.options,o=a.viewMode,d=this.container,c=d.width,h=d.height,l=this.canvas,u=l.aspectRatio,_=this.cropBox,p=this.isCropped&&_;e&&(i=ce(a.minCanvasWidth)||0,r=ce(a.minCanvasHeight)||0,o&&(o>1?(i=le(i,c),r=le(r,h),3===o&&(r*u>i?i=r*u:r=i/u)):i?i=le(i,p?_.width:0):r?r=le(r,p?_.height:0):p&&(i=_.width,r=_.height,r*u>i?i=r*u:r=i/u)),i&&r?r*u>i?r=i/u:i=r*u:i?r=i/u:r&&(i=r*u),l.minWidth=i,l.minHeight=r,l.maxWidth=1/0,l.maxHeight=1/0),t&&(o?(n=c-l.width,s=h-l.height,l.minLeft=he(0,n),l.minTop=he(0,s),l.maxLeft=le(0,n),l.maxTop=le(0,s),p&&this.isLimited&&(l.minLeft=he(_.left,_.left+_.width-l.width),l.minTop=he(_.top,_.top+_.height-l.height),l.maxLeft=_.left,l.maxTop=_.top,2===o&&(l.width>=c&&(l.minLeft=he(0,n),l.maxLeft=le(0,n)),l.height>=h&&(l.minTop=he(0,s),l.maxTop=le(0,s))))):(l.minLeft=-l.width,l.minTop=-l.height,l.maxLeft=c,l.maxTop=h))},renderCanvas:function(e){var t,i,r=this.canvas,n=this.image,s=n.rotate,a=n.naturalWidth,o=n.naturalHeight;this.isRotated&&(this.isRotated=!1,i=h({width:n.width,height:n.height,degree:s}),(t=i.width/i.height)!==r.aspectRatio&&(r.left-=(i.width-r.width)/2,r.top-=(i.height-r.height)/2,r.width=i.width,r.height=i.height,r.aspectRatio=t,r.naturalWidth=a,r.naturalHeight=o,s%180&&(i=h({width:a,height:o,degree:s}),r.naturalWidth=i.width,r.naturalHeight=i.height),this.limitCanvas(!0,!1))),(r.width>r.maxWidth||r.width<r.minWidth)&&(r.left=r.oldLeft),(r.height>r.maxHeight||r.height<r.minHeight)&&(r.top=r.oldTop),r.width=he(le(r.width,r.minWidth),r.maxWidth),r.height=he(le(r.height,r.minHeight),r.maxHeight),this.limitCanvas(!1,!0),r.oldLeft=r.left=he(le(r.left,r.minLeft),r.maxLeft),r.oldTop=r.top=he(le(r.top,r.minTop),r.maxTop),this.$canvas.css({width:r.width,height:r.height,left:r.left,top:r.top}),this.renderImage(),this.isCropped&&this.isLimited&&this.limitCropBox(!0,!0),e&&this.output()},renderImage:function(t){var i,r=this.canvas,n=this.image;n.rotate&&(i=h({width:r.width,height:r.height,degree:n.rotate,aspectRatio:n.aspectRatio},!0)),e.extend(n,i?{width:i.width,height:i.height,left:(r.width-i.width)/2,top:(r.height-i.height)/2}:{width:r.width,height:r.height,left:0,top:0}),this.$clone.css({width:n.width,height:n.height,marginLeft:n.left,marginTop:n.top,transform:c(n)}),t&&this.output()},initCropBox:function(){var t=this.options,i=this.canvas,r=t.aspectRatio,n=ce(t.autoCropArea)||.8,s={width:i.width,height:i.height};r&&(i.height*r>i.width?s.height=s.width/r:s.width=s.height*r),this.cropBox=s,this.limitCropBox(!0,!0),s.width=he(le(s.width,s.minWidth),s.maxWidth),s.height=he(le(s.height,s.minHeight),s.maxHeight),s.width=le(s.minWidth,s.width*n),s.height=le(s.minHeight,s.height*n),s.oldLeft=s.left=i.left+(i.width-s.width)/2,s.oldTop=s.top=i.top+(i.height-s.height)/2,this.initialCropBox=e.extend({},s)},limitCropBox:function(e,t){var i,r,n,s,a=this.options,o=a.aspectRatio,d=this.container,c=d.width,h=d.height,l=this.canvas,u=this.cropBox,_=this.isLimited;e&&(i=ce(a.minCropBoxWidth)||0,r=ce(a.minCropBoxHeight)||0,i=he(i,c),r=he(r,h),n=he(c,_?l.width:c),s=he(h,_?l.height:h),o&&(i&&r?r*o>i?r=i/o:i=r*o:i?r=i/o:r&&(i=r*o),s*o>n?s=n/o:n=s*o),u.minWidth=he(i,n),u.minHeight=he(r,s),u.maxWidth=n,u.maxHeight=s),t&&(_?(u.minLeft=le(0,l.left),u.minTop=le(0,l.top),u.maxLeft=he(c,l.left+l.width)-u.width,u.maxTop=he(h,l.top+l.height)-u.height):(u.minLeft=0,u.minTop=0,u.maxLeft=c-u.width,u.maxTop=h-u.height))},renderCropBox:function(){var e=this.options,t=this.container,i=t.width,r=t.height,n=this.cropBox;(n.width>n.maxWidth||n.width<n.minWidth)&&(n.left=n.oldLeft),(n.height>n.maxHeight||n.height<n.minHeight)&&(n.top=n.oldTop),n.width=he(le(n.width,n.minWidth),n.maxWidth),n.height=he(le(n.height,n.minHeight),n.maxHeight),this.limitCropBox(!1,!0),n.oldLeft=n.left=he(le(n.left,n.minLeft),n.maxLeft),n.oldTop=n.top=he(le(n.top,n.minTop),n.maxTop),e.movable&&e.cropBoxMovable&&this.$face.data(G,n.width===i&&n.height===r?se:"all"),this.$cropBox.css({width:n.width,height:n.height,left:n.left,top:n.top}),this.isCropped&&this.isLimited&&this.limitCanvas(!0,!0),this.isDisabled||this.output()},output:function(){this.preview(),this.isCompleted&&this.trigger(J,this.getData())},initPreview:function(){var t,i=o(this.crossOrigin),r=i?this.crossOriginUrl:this.url;this.$preview=e(this.options.preview),this.$clone2=t=e("<img"+i+' src="'+r+'">'),this.$viewBox.html(t),this.$preview.each(function(){var t=e(this);t.data(Z,{width:t.width(),height:t.height(),html:t.html()}),t.html("<img"+i+' src="'+r+'" style="display:block;width:100%;height:auto;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important;">')})},resetPreview:function(){this.$preview.each(function(){var t=e(this),i=t.data(Z);t.css({width:i.width,height:i.height}).html(i.html).removeData(Z)})},preview:function(){var t=this.image,i=this.canvas,r=this.cropBox,n=r.width,s=r.height,a=t.width,o=t.height,d=r.left-i.left-t.left,h=r.top-i.top-t.top;this.isCropped&&!this.isDisabled&&(this.$clone2.css({width:a,height:o,marginLeft:-d,marginTop:-h,transform:c(t)}),this.$preview.each(function(){var i=e(this),r=i.data(Z),l=r.width,u=r.height,_=l,p=u,f=1;n&&(f=l/n,p=s*f),s&&p>u&&(f=u/s,_=n*f,p=u),i.css({width:_,height:p}).find("img").css({width:a*f,height:o*f,marginLeft:-d*f,marginTop:-h*f,transform:c(t)})}))},bind:function(){var t=this.options,i=this.$element,r=this.$cropper;e.isFunction(t.cropstart)&&i.on(q,t.cropstart),e.isFunction(t.cropmove)&&i.on(I,t.cropmove),e.isFunction(t.cropend)&&i.on(F,t.cropend),e.isFunction(t.crop)&&i.on(J,t.crop),e.isFunction(t.zoom)&&i.on(U,t.zoom),r.on(E,e.proxy(this.cropStart,this)),t.zoomable&&t.zoomOnWheel&&r.on(L,e.proxy(this.wheel,this)),t.toggleDragModeOnDblclick&&r.on(z,e.proxy(this.dblclick,this)),y.on(D,this._cropMove=n(this.cropMove,this)).on(P,this._cropEnd=n(this.cropEnd,this)),t.responsive&&v.on(M,this._resize=n(this.resize,this))},unbind:function(){var t=this.options,i=this.$element,r=this.$cropper;e.isFunction(t.cropstart)&&i.off(q,t.cropstart),e.isFunction(t.cropmove)&&i.off(I,t.cropmove),e.isFunction(t.cropend)&&i.off(F,t.cropend),e.isFunction(t.crop)&&i.off(J,t.crop),e.isFunction(t.zoom)&&i.off(U,t.zoom),r.off(E,this.cropStart),t.zoomable&&t.zoomOnWheel&&r.off(L,this.wheel),t.toggleDragModeOnDblclick&&r.off(z,this.dblclick),y.off(D,this._cropMove).off(P,this._cropEnd),t.responsive&&v.off(M,this._resize)},resize:function(){var t,i,r,n=this.options.restore,s=this.$container,a=this.container;!this.isDisabled&&a&&(1===(r=s.width()/a.width)&&s.height()===a.height||(n&&(t=this.getCanvasData(),i=this.getCropBoxData()),this.render(),n&&(this.setCanvasData(e.each(t,function(e,i){t[e]=i*r})),this.setCropBoxData(e.each(i,function(e,t){i[e]=t*r})))))},dblclick:function(){this.isDisabled||(this.$dragBox.hasClass(N)?this.setDragMode(se):this.setDragMode(ne))},wheel:function(t){var i=t.originalEvent||t,r=ce(this.options.wheelZoomRatio)||.1,n=1;this.isDisabled||(t.preventDefault(),this.wheeling||(this.wheeling=!0,setTimeout(e.proxy(function(){this.wheeling=!1},this),50),i.deltaY?n=i.deltaY>0?1:-1:i.wheelDelta?n=-i.wheelDelta/120:i.detail&&(n=i.detail>0?1:-1),this.zoom(-n*r,t)))},cropStart:function(t){var i,r,n=this.options,s=t.originalEvent,a=s&&s.touches,o=t;if(!this.isDisabled){if(a){if((i=a.length)>1){if(!n.zoomable||!n.zoomOnTouch||2!==i)return;o=a[1],this.startX2=o.pageX,this.startY2=o.pageY,r=ae}o=a[0]}if(r=r||e(o.target).data(G),K.test(r)){if(this.trigger(q,{originalEvent:s,action:r}).isDefaultPrevented())return;t.preventDefault(),this.action=r,this.cropping=!1,this.startX=o.pageX||s&&s.pageX,this.startY=o.pageY||s&&s.pageY,r===ne&&(this.cropping=!0,this.$dragBox.addClass(O))}}},cropMove:function(e){var t,i=this.options,r=e.originalEvent,n=r&&r.touches,s=e,a=this.action;if(!this.isDisabled){if(n){if((t=n.length)>1){if(!i.zoomable||!i.zoomOnTouch||2!==t)return;s=n[1],this.endX2=s.pageX,this.endY2=s.pageY}s=n[0]}if(a){if(this.trigger(I,{originalEvent:r,action:a}).isDefaultPrevented())return;e.preventDefault(),this.endX=s.pageX||r&&r.pageX,this.endY=s.pageY||r&&r.pageY,this.change(s.shiftKey,a===ae?e:null)}}},cropEnd:function(e){var t=e.originalEvent,i=this.action;this.isDisabled||i&&(e.preventDefault(),this.cropping&&(this.cropping=!1,this.$dragBox.toggleClass(O,this.isCropped&&this.options.modal)),this.action="",this.trigger(F,{originalEvent:t,action:i}))},change:function(e,t){var i,r,n=this.options,s=n.aspectRatio,a=this.action,o=this.container,d=this.canvas,c=this.cropBox,h=c.width,l=c.height,u=c.left,_=c.top,p=u+h,f=_+l,g=0,m=0,v=o.width,y=o.height,x=!0;switch(!s&&e&&(s=h&&l?h/l:1),this.isLimited&&(g=c.minLeft,m=c.minTop,v=g+he(o.width,d.left+d.width),y=m+he(o.height,d.top+d.height)),r={x:this.endX-this.startX,y:this.endY-this.startY},s&&(r.X=r.y*s,r.Y=r.x/s),a){case"all":u+=r.x,_+=r.y;break;case"e":if(r.x>=0&&(p>=v||s&&(m>=_||f>=y))){x=!1;break}h+=r.x,s&&(l=h/s,_-=r.Y/2),0>h&&(a="w",h=0);break;case"n":if(r.y<=0&&(m>=_||s&&(g>=u||p>=v))){x=!1;break}l-=r.y,_+=r.y,s&&(h=l*s,u+=r.X/2),0>l&&(a="s",l=0);break;case"w":if(r.x<=0&&(g>=u||s&&(m>=_||f>=y))){x=!1;break}h-=r.x,u+=r.x,s&&(l=h/s,_+=r.Y/2),0>h&&(a="e",h=0);break;case"s":if(r.y>=0&&(f>=y||s&&(g>=u||p>=v))){x=!1;break}l+=r.y,s&&(h=l*s,u-=r.X/2),0>l&&(a="n",l=0);break;case ie:if(s){if(r.y<=0&&(m>=_||p>=v)){x=!1;break}l-=r.y,_+=r.y,h=l*s}else r.x>=0?v>p?h+=r.x:r.y<=0&&m>=_&&(x=!1):h+=r.x,r.y<=0?_>m&&(l-=r.y,_+=r.y):(l-=r.y,_+=r.y);0>h&&0>l?(a=te,l=0,h=0):0>h?(a=re,h=0):0>l&&(a=ee,l=0);break;case re:if(s){if(r.y<=0&&(m>=_||g>=u)){x=!1;break}l-=r.y,_+=r.y,h=l*s,u+=r.X}else r.x<=0?u>g?(h-=r.x,u+=r.x):r.y<=0&&m>=_&&(x=!1):(h-=r.x,u+=r.x),r.y<=0?_>m&&(l-=r.y,_+=r.y):(l-=r.y,_+=r.y);0>h&&0>l?(a=ee,l=0,h=0):0>h?(a=ie,h=0):0>l&&(a=te,l=0);break;case te:if(s){if(r.x<=0&&(g>=u||f>=y)){x=!1;break}h-=r.x,u+=r.x,l=h/s}else r.x<=0?u>g?(h-=r.x,u+=r.x):r.y>=0&&f>=y&&(x=!1):(h-=r.x,u+=r.x),r.y>=0?y>f&&(l+=r.y):l+=r.y;0>h&&0>l?(a=ie,l=0,h=0):0>h?(a=ee,h=0):0>l&&(a=re,l=0);break;case ee:if(s){if(r.x>=0&&(p>=v||f>=y)){x=!1;break}h+=r.x,l=h/s}else r.x>=0?v>p?h+=r.x:r.y>=0&&f>=y&&(x=!1):h+=r.x,r.y>=0?y>f&&(l+=r.y):l+=r.y;0>h&&0>l?(a=re,l=0,h=0):0>h?(a=te,h=0):0>l&&(a=ie,l=0);break;case se:this.move(r.x,r.y),x=!1;break;case ae:this.zoom(function(e,t,i,r){var n=fe(e*e+t*t);return(fe(i*i+r*r)-n)/n}(ue(this.startX-this.startX2),ue(this.startY-this.startY2),ue(this.endX-this.endX2),ue(this.endY-this.endY2)),t),this.startX2=this.endX2,this.startY2=this.endY2,x=!1;break;case ne:if(!r.x||!r.y){x=!1;break}i=this.$cropper.offset(),u=this.startX-i.left,_=this.startY-i.top,h=c.minWidth,l=c.minHeight,r.x>0?a=r.y>0?ee:ie:r.x<0&&(u-=h,a=r.y>0?te:re),r.y<0&&(_-=l),this.isCropped||(this.$cropBox.removeClass(B),this.isCropped=!0,this.isLimited&&this.limitCropBox(!0,!0))}x&&(c.width=h,c.height=l,c.left=u,c.top=_,this.action=a,this.renderCropBox()),this.startX=this.endX,this.startY=this.endY},crop:function(){this.isBuilt&&!this.isDisabled&&(this.isCropped||(this.isCropped=!0,this.limitCropBox(!0,!0),this.options.modal&&this.$dragBox.addClass(O),this.$cropBox.removeClass(B)),this.setCropBoxData(this.initialCropBox))},reset:function(){this.isBuilt&&!this.isDisabled&&(this.image=e.extend({},this.initialImage),this.canvas=e.extend({},this.initialCanvas),this.cropBox=e.extend({},this.initialCropBox),this.renderCanvas(),this.isCropped&&this.renderCropBox())},clear:function(){this.isCropped&&!this.isDisabled&&(e.extend(this.cropBox,{left:0,top:0,width:0,height:0}),this.isCropped=!1,this.renderCropBox(),this.limitCanvas(!0,!0),this.renderCanvas(),this.$dragBox.removeClass(O),this.$cropBox.addClass(B))},replace:function(e,t){!this.isDisabled&&e&&(this.isImg&&this.$element.attr("src",e),t?(this.url=e,this.$clone.attr("src",e),this.isBuilt&&this.$preview.find("img").add(this.$clone2).attr("src",e)):(this.isImg&&(this.isReplaced=!0),this.options.data=null,this.load(e)))},enable:function(){this.isBuilt&&(this.isDisabled=!1,this.$cropper.removeClass(A))},disable:function(){this.isBuilt&&(this.isDisabled=!0,this.$cropper.addClass(A))},destroy:function(){var e=this.$element;this.isLoaded?(this.isImg&&this.isReplaced&&e.attr("src",this.originalUrl),this.unbuild(),e.removeClass(B)):this.isImg?e.off(W,this.start):this.$clone&&this.$clone.remove(),e.removeData(T)},move:function(e,t){var r=this.canvas;this.moveTo(i(e)?e:r.left+ce(e),i(t)?t:r.top+ce(t))},moveTo:function(e,r){var n=this.canvas,s=!1;i(r)&&(r=e),e=ce(e),r=ce(r),this.isBuilt&&!this.isDisabled&&this.options.movable&&(t(e)&&(n.left=e,s=!0),t(r)&&(n.top=r,s=!0),s&&this.renderCanvas(!0))},zoom:function(e,t){var i=this.canvas;e=ce(e),e=0>e?1/(1-e):1+e,this.zoomTo(i.width*e/i.naturalWidth,t)},zoomTo:function(e,t){var i,r,n,s,a,o=this.options,d=this.canvas,c=d.width,h=d.height,l=d.naturalWidth,_=d.naturalHeight;if((e=ce(e))>=0&&this.isBuilt&&!this.isDisabled&&o.zoomable){if(r=l*e,n=_*e,t&&(i=t.originalEvent),this.trigger(U,{originalEvent:i,oldRatio:c/l,ratio:r/l}).isDefaultPrevented())return;i?(s=this.$cropper.offset(),a=i.touches?u(i.touches):{pageX:t.pageX||i.pageX||0,pageY:t.pageY||i.pageY||0},d.left-=(r-c)*((a.pageX-s.left-d.left)/c),d.top-=(n-h)*((a.pageY-s.top-d.top)/h)):(d.left-=(r-c)/2,d.top-=(n-h)/2),d.width=r,d.height=n,this.renderCanvas(!0)}},rotate:function(e){this.rotateTo((this.image.rotate||0)+ce(e))},rotateTo:function(e){e=ce(e),t(e)&&this.isBuilt&&!this.isDisabled&&this.options.rotatable&&(this.image.rotate=e%360,this.isRotated=!0,this.renderCanvas(!0))},scale:function(e,r){var n=this.image,s=!1;i(r)&&(r=e),e=ce(e),r=ce(r),this.isBuilt&&!this.isDisabled&&this.options.scalable&&(t(e)&&(n.scaleX=e,s=!0),t(r)&&(n.scaleY=r,s=!0),s&&this.renderImage(!0))},scaleX:function(e){var i=this.image.scaleY;this.scale(e,t(i)?i:1)},scaleY:function(e){var i=this.image.scaleX;this.scale(t(i)?i:1,e)},getData:function(t){var i,r,n=this.options,s=this.image,a=this.canvas,o=this.cropBox;return this.isBuilt&&this.isCropped?(r={x:o.left-a.left,y:o.top-a.top,width:o.width,height:o.height},i=s.width/s.naturalWidth,e.each(r,function(e,n){n/=i,r[e]=t?ge(n):n})):r={x:0,y:0,width:0,height:0},n.rotatable&&(r.rotate=s.rotate||0),n.scalable&&(r.scaleX=s.scaleX||1,r.scaleY=s.scaleY||1),r},setData:function(i){var r,n,s,a=this.options,o=this.image,d=this.canvas,c={};e.isFunction(i)&&(i=i.call(this.element)),this.isBuilt&&!this.isDisabled&&e.isPlainObject(i)&&(a.rotatable&&t(i.rotate)&&i.rotate!==o.rotate&&(o.rotate=i.rotate,this.isRotated=r=!0),a.scalable&&(t(i.scaleX)&&i.scaleX!==o.scaleX&&(o.scaleX=i.scaleX,n=!0),t(i.scaleY)&&i.scaleY!==o.scaleY&&(o.scaleY=i.scaleY,n=!0)),r?this.renderCanvas():n&&this.renderImage(),s=o.width/o.naturalWidth,t(i.x)&&(c.left=i.x*s+d.left),t(i.y)&&(c.top=i.y*s+d.top),t(i.width)&&(c.width=i.width*s),t(i.height)&&(c.height=i.height*s),this.setCropBoxData(c))},getContainerData:function(){return this.isBuilt?this.container:{}},getImageData:function(){return this.isLoaded?this.image:{}},getCanvasData:function(){var t=this.canvas,i={};return this.isBuilt&&e.each(["left","top","width","height","naturalWidth","naturalHeight"],function(e,r){i[r]=t[r]}),i},setCanvasData:function(i){var r=this.canvas,n=r.aspectRatio;e.isFunction(i)&&(i=i.call(this.$element)),this.isBuilt&&!this.isDisabled&&e.isPlainObject(i)&&(t(i.left)&&(r.left=i.left),t(i.top)&&(r.top=i.top),t(i.width)?(r.width=i.width,r.height=i.width/n):t(i.height)&&(r.height=i.height,r.width=i.height*n),
this.renderCanvas(!0))},getCropBoxData:function(){var e,t=this.cropBox;return this.isBuilt&&this.isCropped&&(e={left:t.left,top:t.top,width:t.width,height:t.height}),e||{}},setCropBoxData:function(i){var r,n,s=this.cropBox,a=this.options.aspectRatio;e.isFunction(i)&&(i=i.call(this.$element)),this.isBuilt&&this.isCropped&&!this.isDisabled&&e.isPlainObject(i)&&(t(i.left)&&(s.left=i.left),t(i.top)&&(s.top=i.top),t(i.width)&&(r=!0,s.width=i.width),t(i.height)&&(n=!0,s.height=i.height),a&&(r?s.height=s.width/a:n&&(s.width=s.height*a)),this.renderCropBox())},getCroppedCanvas:function(t){var i,r,n,s,a,o,d,c,h,u,_;return this.isBuilt&&oe?this.isCropped?(e.isPlainObject(t)||(t={}),_=this.getData(),i=_.width,r=_.height,c=i/r,e.isPlainObject(t)&&(a=t.width,o=t.height,a?(o=a/c,d=a/i):o&&(a=o*c,d=o/r)),n=me(a||i),s=me(o||r),h=e("<canvas>")[0],h.width=n,h.height=s,u=h.getContext("2d"),t.fillColor&&(u.fillStyle=t.fillColor,u.fillRect(0,0,n,s)),u.drawImage.apply(u,function(){var e,t,n,s,a,o,c=l(this.$clone[0],this.image),h=c.width,u=c.height,p=this.canvas,f=[c],g=_.x+p.naturalWidth*(ue(_.scaleX||1)-1)/2,m=_.y+p.naturalHeight*(ue(_.scaleY||1)-1)/2;return-i>=g||g>h?g=e=n=a=0:0>=g?(n=-g,g=0,e=a=he(h,i+g)):h>=g&&(n=0,e=a=he(i,h-g)),0>=e||-r>=m||m>u?m=t=s=o=0:0>=m?(s=-m,m=0,t=o=he(u,r+m)):u>=m&&(s=0,t=o=he(r,u-m)),f.push(me(g),me(m),me(e),me(t)),d&&(n*=d,s*=d,a*=d,o*=d),a>0&&o>0&&f.push(me(n),me(s),me(a),me(o)),f}.call(this)),h):l(this.$clone[0],this.image):void 0},setAspectRatio:function(e){var t=this.options;this.isDisabled||i(e)||(t.aspectRatio=le(0,e)||NaN,this.isBuilt&&(this.initCropBox(),this.isCropped&&this.renderCropBox()))},setDragMode:function(e){var t,i,r=this.options;this.isLoaded&&!this.isDisabled&&(t=e===ne,i=r.movable&&e===se,e=t||i?e:"none",this.$dragBox.data(G,e).toggleClass(N,t).toggleClass(S,i),r.cropBoxMovable||this.$face.data(G,e).toggleClass(N,t).toggleClass(S,i))}},m.DEFAULTS={viewMode:0,dragMode:"crop",aspectRatio:NaN,data:null,preview:"",responsive:!0,restore:!0,checkCrossOrigin:!0,checkOrientation:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,wheelZoomRatio:.1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:200,minContainerHeight:100,build:null,built:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null},m.setDefaults=function(t){e.extend(m.DEFAULTS,t)},m.TEMPLATE='<div class="cropper-container"><div class="cropper-wrap-box"><div class="cropper-canvas"></div></div><div class="cropper-drag-box"></div><div class="cropper-crop-box"><span class="cropper-view-box"></span><span class="cropper-dashed dashed-h"></span><span class="cropper-dashed dashed-v"></span><span class="cropper-center"></span><span class="cropper-face"></span><span class="cropper-line line-e" data-action="e"></span><span class="cropper-line line-n" data-action="n"></span><span class="cropper-line line-w" data-action="w"></span><span class="cropper-line line-s" data-action="s"></span><span class="cropper-point point-e" data-action="e"></span><span class="cropper-point point-n" data-action="n"></span><span class="cropper-point point-w" data-action="w"></span><span class="cropper-point point-s" data-action="s"></span><span class="cropper-point point-ne" data-action="ne"></span><span class="cropper-point point-nw" data-action="nw"></span><span class="cropper-point point-sw" data-action="sw"></span><span class="cropper-point point-se" data-action="se"></span></div></div>',m.other=e.fn.cropper,e.fn.cropper=function(t){var n,s=r(arguments,1);return this.each(function(){var i,r,a=e(this),o=a.data(T);if(!o){if(/destroy/.test(t))return;i=e.extend({},a.data(),e.isPlainObject(t)&&t),a.data(T,o=new m(this,i))}"string"==typeof t&&e.isFunction(r=o[t])&&(n=r.apply(o,s))}),i(n)?this:n},e.fn.cropper.Constructor=m,e.fn.cropper.setDefaults=m.setDefaults,e.fn.cropper.noConflict=function(){return e.fn.cropper=m.other,this}});
